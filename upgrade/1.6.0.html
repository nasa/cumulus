
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>1.6.0 Â· Cumulus Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="1.7.0.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Home
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../architecture.html">
            
                <a href="../architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../workflows/">
            
                <a href="../workflows/">
            
                    
                    What are Cumulus Workflows?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../workflows/protocol.html">
            
                <a href="../workflows/protocol.html">
            
                    
                    Workflow Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tasks.html">
            
                <a href="../tasks.html">
            
                    
                    Workflow Tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../workflows/input_output.html">
            
                <a href="../workflows/input_output.html">
            
                    
                    Workflow Input & Ouptut
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../workflows/cumulus-task-message-flow.html">
            
                <a href="../workflows/cumulus-task-message-flow.html">
            
                    
                    Workflow Task Message Flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../workflows/developing-workflow-tasks.html">
            
                <a href="../workflows/developing-workflow-tasks.html">
            
                    
                    Developing Workflow Tasks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="../workflows/lambda.html">
            
                <a href="../workflows/lambda.html">
            
                    
                    Lambda Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" data-path="../workflows/docker.html">
            
                <a href="../workflows/docker.html">
            
                    
                    Dockerization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../workflows/workflow-configuration-how-to.html">
            
                <a href="../workflows/workflow-configuration-how-to.html">
            
                    
                    Workflow Configuration How-to's
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../deployment/">
            
                <a href="../deployment/">
            
                    
                    How to Deploy Cumulus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../deployment/create_bucket.html">
            
                <a href="../deployment/create_bucket.html">
            
                    
                    Creating an S3 Bucket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../deployment/iam_roles.html">
            
                <a href="../deployment/iam_roles.html">
            
                    
                    Locating IAMs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../deployment/troubleshoot_deployment.html">
            
                <a href="../deployment/troubleshoot_deployment.html">
            
                    
                    Troubleshooting Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <a target="_blank" href="https://nasa.github.io/cumulus-api">
            
                    
                    Cumulus API Docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Additional Cumulus Features
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../data_in_dynamodb.html">
            
                <a href="../data_in_dynamodb.html#cumulus-metadata-in-dynamodb">
            
                    
                    Cumulus Metadata in DynamoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../data_in_dynamodb.html">
            
                <a href="../data_in_dynamodb.html#backup-and-restore-with-aws">
            
                    
                    DynamoDB Backup and Restore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../data_in_dynamodb.html">
            
                <a href="../data_in_dynamodb.html#dynamodb-auto-scaling">
            
                    
                    DynamoDB Auto Scaling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../ems_reporting.html">
            
                <a href="../ems_reporting.html">
            
                    
                    EMS Reporting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <a target="_blank" href="https://github.com/nasa/cumulus/blob/master/CHANGELOG.md">
            
                    
                    Changelog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="./">
            
                <a href="./">
            
                    
                    Upgrade Instructions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.8.1" data-path="1.6.0.html">
            
                <a href="1.6.0.html">
            
                    
                    1.6.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="1.7.0.html">
            
                <a href="1.7.0.html">
            
                    
                    1.7.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="1.9.0.html">
            
                <a href="1.9.0.html">
            
                    
                    1.9.0
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../system-documentation/system-documentation.html">
            
                <a href="../system-documentation/system-documentation.html">
            
                    
                    Operating and Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../doc_installation.html">
            
                <a href="../doc_installation.html">
            
                    
                    Contributing to documentation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../adding-a-task.html">
            
                <a href="../adding-a-task.html">
            
                    
                    Contributing a task
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../team.html">
            
                <a href="../team.html">
            
                    
                    Team
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Data Cookbook</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../data-cookbooks/about-cookbooks.html">
            
                <a href="../data-cookbooks/about-cookbooks.html">
            
                    
                    About Cookbooks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../data-cookbooks/setup.html">
            
                <a href="../data-cookbooks/setup.html">
            
                    
                    Collections, Providers, Schemas, and Rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../data-cookbooks/hello-world.html">
            
                <a href="../data-cookbooks/hello-world.html">
            
                    
                    HelloWorldWorkflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../data-cookbooks/sns.html">
            
                <a href="../data-cookbooks/sns.html">
            
                    
                    SNS Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../data-cookbooks/sips-workflow.html">
            
                <a href="../data-cookbooks/sips-workflow.html">
            
                    
                    SIPS Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../data-cookbooks/error-handling.html">
            
                <a href="../data-cookbooks/error-handling.html">
            
                    
                    Error Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../data-cookbooks/choice-states.html">
            
                <a href="../data-cookbooks/choice-states.html">
            
                    
                    Choice States
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >1.6.0</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="upgarding-to-cumulus-160">Upgarding to Cumulus 1.6.0</h1>
<p>Cumulus 1.6 is bringing a lot of new functionality for configuring how granules are stored. Configuration updates are required to support this new functionality.
The <a href="https://github.com/nasa/cumulus/tree/master/example" target="_blank">Cumulus example deployment</a> has been updated to run and test all of these changes and should be used as an example when updating workflow configurations. Specific examples are linked below.</p>
<h2 id="additional-functionality">Additional Functionality</h2>
<ul>
<li>Using metadata to determine granule storage location in S3.<ul>
<li>Instead of being limited to parameters defined in config.yml or hardcoded parameters, the S3 location can now be dynamically determined based on the CMR metadata.</li>
<li>Can configure paths for individual files or for the overall collection</li>
<li>Ability to extract parts of metadata dates for storage location - i.e. can organize folders in the S3 bucket by granule month</li>
<li>Ability to substring metadata to configure storage location</li>
</ul>
</li>
<li>Configuring multiple buckets of the same type, i.e. multiple protected buckets and configuring different files to go in different buckets</li>
</ul>
<p>To get started with this new functionality, check out <a href="https://nasa.github.io/cumulus/workflows/workflow-configuration-how-to.html" target="_blank">Workflow Configuration How-To&apos;s</a> and the <a href="https://github.com/nasa/cumulus/blob/master/example/data/collections/s3_MOD09GQ_006.json#L17" target="_blank">Cumulus example collection configuration.</a></p>
<h2 id="deployment-changes">Deployment Changes</h2>
<p>Upgrade kes version to 2.2.2
An IAM template is now in the deployment package. To use this template when deploying IAMs, add <code>--template node_modules/@cumulus/deployment/iam</code> to your deployment command (this is the same way app deployment is done - see <a href="https://nasa.github.io/cumulus/deployment" target="_blank">deployment documentation</a>). Make sure to redeploy your IAM roles.
<strong>Config Changes</strong>
Configure system_bucket in iam/config.yml and app/config.yml - kes will use this instead of buckets.internal and the system_bucket in the workflows will be populated with this value. (<a href="https://github.com/nasa/cumulus/blob/master/example/app/config.yml#L54" target="_blank">Example</a>)
The structure of buckets has changed. It is no longer key/value, but has a key, bucket name, and level. The key can be used in collection configurations so if the bucket name changes, it can be updated in the configuration without having to update collection definitions. (<a href="https://github.com/nasa/cumulus/blob/master/example/app/config.yml#L56" target="_blank">Example</a>)
The new bucket structure should be put in iam/config.yml and app/config.yml. (<a href="https://github.com/nasa/cumulus/blob/master/example/iam/config.yml" target="_blank">IAM config.yml example</a> and <a href="https://github.com/nasa/cumulus/blob/master/example/app/config.yml" target="_blank">app config.yml example</a>)
Following deployment of 1.6.0, your distribution API Gateway URL will be changed and you will have to update your redirect URI on URS. Please note the output URLs in your deployment.</p>
<h2 id="workflow-configuration-changes">Workflow Configuration Changes</h2>
<p>To support using metadata to configure storage locations, the Sync Granule task now writes to a staging location and the granule files are moved when the metadata becomes available. The MoveGranules task moves files to the correct location before Post to CMR.
Add MoveGranules to your workflow before Post to CMR. Lambdas.yml and Workflows.yml should be updated for this change. (<a href="https://github.com/nasa/cumulus/blob/master/example/workflows.yml#L362" target="_blank">Example</a>)</p>
<p>Post to CMR task:</p>
<ul>
<li>Config:<ul>
<li>Process required</li>
<li>Input_granules no longer needed</li>
</ul>
</li>
<li>Input:<ul>
<li>Granules required. The granules object has been updated in the schema to include the expected format</li>
</ul>
</li>
<li>Output (no updates required)<ul>
<li>Process is now output</li>
</ul>
</li>
</ul>
<p>Sync Granules task:</p>
<ul>
<li>Config:<ul>
<li>Stack parameter added - used for the file staging directory when none is specified</li>
<li>fileStagingDir parameter added - this can be used to specify a custom staging directory</li>
<li>Either stack of fileStagingDir should be part of the config</li>
</ul>
</li>
<li>Output (no updates required)<ul>
<li>fileStagingDir output</li>
<li>Url_path output<h2 id="cumulus-process-py">Cumulus-process-py</h2>
</li>
</ul>
</li>
</ul>
<p>Cumulus-process-py has been updated to accommodate granule files first being stored in a staging directory. You will need the latest version of cumulus-process-py.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Upgrade Instructions">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="1.7.0.html" class="navigation navigation-next " aria-label="Next page: 1.7.0">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"1.6.0","level":"1.8.1","depth":2,"next":{"title":"1.7.0","level":"1.8.2","depth":2,"path":"upgrade/1.7.0.md","ref":"upgrade/1.7.0.md","articles":[]},"previous":{"title":"Upgrade Instructions","level":"1.8","depth":1,"path":"upgrade/README.md","ref":"upgrade/README.md","articles":[{"title":"1.6.0","level":"1.8.1","depth":2,"path":"upgrade/1.6.0.md","ref":"upgrade/1.6.0.md","articles":[]},{"title":"1.7.0","level":"1.8.2","depth":2,"path":"upgrade/1.7.0.md","ref":"upgrade/1.7.0.md","articles":[]},{"title":"1.9.0","level":"1.8.3","depth":2,"path":"upgrade/1.9.0.md","ref":"upgrade/1.9.0.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":[],"root":"docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Cumulus Documentation","gitbook":"*"},"file":{"path":"upgrade/1.6.0.md","mtime":"2018-08-31T14:24:16.992Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-08-31T14:25:31.463Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

