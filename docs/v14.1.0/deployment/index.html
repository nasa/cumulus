<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v14.1.0 plugin-docs plugin-id-default docs-doc-id-deployment/deployment-readme" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">How to Deploy Cumulus | Cumulus Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nasa.github.io/cumulus/docs/v14.1.0/deployment/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v14.1.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v14.1.0"><meta data-rh="true" name="docsearch:version" content="v14.1.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v14.1.0"><meta data-rh="true" property="og:title" content="How to Deploy Cumulus | Cumulus Documentation"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/cumulus/img/cumulus.ico"><link data-rh="true" rel="canonical" href="https://nasa.github.io/cumulus/docs/v14.1.0/deployment/"><link data-rh="true" rel="alternate" href="https://nasa.github.io/cumulus/docs/v14.1.0/deployment/" hreflang="en"><link data-rh="true" rel="alternate" href="https://nasa.github.io/cumulus/docs/v14.1.0/deployment/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBWSJQ0LBW-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Cumulus Documentation" href="/cumulus/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/cumulus/assets/css/styles.d37fa5d4.css">
<link rel="preload" href="/cumulus/assets/js/runtime~main.6d34a879.js" as="script">
<link rel="preload" href="/cumulus/assets/js/main.1257b213.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cumulus/"><div class="navbar__logo"><img src="/cumulus/img/ic_cumulus_logo_white.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA" height="32" width="32"><img src="/cumulus/img/ic_cumulus_logo_white.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU" height="32" width="32"></div><b class="navbar__title text--truncate">Cumulus Documentation</b></a><a href="https://nasa.github.io/cumulus-api" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://nasa.github.io/cumulus-distribution-api" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Distribution API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus/docs/v14.1.0/">Developer Docs</a><a class="navbar__item navbar__link" href="/cumulus/docs/v14.1.0/data-cookbooks/about-cookbooks">Data Cookbooks</a><a class="navbar__item navbar__link" href="/cumulus/docs/v14.1.0/operator-docs/about-operator-docs">Operator Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/cumulus/docs/v14.1.0/">v14.1.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cumulus/docs/next/deployment/">Next</a></li><li><a class="dropdown__link" href="/cumulus/docs/deployment/">v19.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.4.0/deployment/">v18.4.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.3.4/deployment/">v18.3.4</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.2.0/deployment/">v18.2.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.1.0/deployment/">v18.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.0.0/deployment/">v18.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v17.0.0/deployment/">v17.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v16.1.3/deployment/">v16.1.3</a></li><li><a class="dropdown__link" href="/cumulus/docs/v16.0.0/deployment/">v16.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v15.0.2/deployment/">v15.0.2</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cumulus/docs/v14.1.0/deployment/">v14.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v13.4.0/deployment/">v13.4.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v13.0.0/deployment/">v13.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v12.0.0/deployment/">v12.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v11.1.0/deployment/">v11.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v11.0.0/deployment/">v11.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v10.1.0/deployment/">v10.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v10.0.0/deployment/">v10.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v9.9.0/deployment/">v9.9.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v9.0.0/deployment/">v9.0.0</a></li><li><hr class="dropdown-separator"></li><li><a class="dropdown__link" href="/cumulus/versions">All versions</a></li></ul></div><a href="https://github.com/nasa/cumulus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="Cumulus Core GitHub Repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/architecture">About Cumulus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/workflows/">Overviews</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/cumulus/docs/v14.1.0/deployment/">Deployment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/">How to Deploy Cumulus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/create_bucket">Creating an S3 Bucket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/terraform-best-practices">Terraform Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/choosing_configuring_rds">Choosing and Configuration Your RDS Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/postgres_database_deployment">PostgreSQL Database Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/components">Component-based Cumulus Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/thin_egress_app">Using the Thin Egress App for Cumulus Distribution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/cumulus_distribution">Using the Cumulus Distribution API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/api-gateway-logging">API Gateway Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/share-s3-access-logs">Share S3 Access Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/cloudwatch-logs-delivery">Configure Cloudwatch Logs Delivery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v14.1.0/deployment/upgrade-readme">Upgrading Cumulus</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/configuration/data-management-types">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/workflows/developing-a-cumulus-workflow">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/tasks">Workflow Tasks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/features/backup_and_restore">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/troubleshooting/">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/adding-a-task">Cumulus Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/integrator-guide/about-int-guide">Integrator Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/upgrade-notes/migrate_tea_standalone">Upgrade Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v14.1.0/external-contributions/">External Contributions</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cumulus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deployment</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How to Deploy Cumulus</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v14.1.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to Deploy Cumulus</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p>This is a guide for deploying a new instance of Cumulus.</p><p>This document assumes familiarity with Terraform. If you are not comfortable
working with Terraform, the following links should bring you up to speed:</p><ul><li><a href="https://www.terraform.io/intro/index.html" target="_blank" rel="noopener noreferrer">Introduction to Terraform</a></li><li><a href="https://learn.hashicorp.com/terraform/?track=getting-started#getting-started" target="_blank" rel="noopener noreferrer">Getting Started with Terraform and Amazon Web Services (AWS)</a></li><li><a href="https://www.terraform.io/docs/configuration/index.html" target="_blank" rel="noopener noreferrer">Terraform Configuration Language</a></li></ul><p>The process involves:</p><ul><li>Creating <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html" target="_blank" rel="noopener noreferrer">AWS S3 Buckets</a></li><li>Configuring a VPC, if necessary</li><li>Configuring an Earthdata application, if necessary</li><li>Creating/configuring a <a href="/cumulus/docs/v14.1.0/deployment/postgres_database_deployment">PostgreSQL compatible database</a>, and an AWS Secrets Manager secret to allow database access</li><li>Creating a Lambda layer for the <a href="/cumulus/docs/v14.1.0/workflows/input_output#cumulus-message-adapter">Cumulus Message Adapter (CMA)</a></li><li>Creating resources for your Terraform backend</li><li>Using <a href="https://www.terraform.io" target="_blank" rel="noopener noreferrer">Terraform</a> to deploy resources to AWS</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linuxmacos-software-requirements">Linux/MacOS Software Requirements<a href="#linuxmacos-software-requirements" class="hash-link" aria-label="Direct link to Linux/MacOS Software Requirements" title="Direct link to Linux/MacOS Software Requirements">​</a></h3><ul><li>git</li><li>zip</li><li>AWS CLI - <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS Command Line Interface</a></li><li><a href="https://www.terraform.io" target="_blank" rel="noopener noreferrer">Terraform</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-terraform">Install Terraform<a href="#install-terraform" class="hash-link" aria-label="Direct link to Install Terraform" title="Direct link to Install Terraform">​</a></h3><p>It is recommended to keep a consistent version of Terraform as you deploy. Once your state files are migrated to a higher version, they are not always backwards compatible so integrators should pin their Terraform version. This is easily accomplished using the Terraform Version Manager <a href="https://github.com/tfutils/tfenv" target="_blank" rel="noopener noreferrer">(tfenv)</a>. If you have a Continuous Integration (CI) environment (or any other machine) that you are using to deploy the same stack, <strong>you should pin your version across those machines as well</strong>, otherwise you will run into errors trying to re-deploy from your local machine.</p><p>If you are using a Mac and <a href="https://brew.sh" target="_blank" rel="noopener noreferrer">Homebrew</a>, installing tfenv is
as simple as:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">brew update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">brew </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> tfenv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For other cases, installation instructions are available to follow along <a href="https://github.com/tfutils/tfenv#installation" target="_blank" rel="noopener noreferrer">here</a>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> $ tfenv </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.13</span><span class="token plain">.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Installing Terraform v0.13.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Switching completed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ tfenv use </span><span class="token number" style="color:rgb(247, 140, 108)">0.13</span><span class="token plain">.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Switching to v0.13.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Switching completed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is recommended to stay on the Cumulus Core TF version which can be found <a href="https://github.com/nasa/cumulus/blob/master/example/.tfversion" target="_blank" rel="noopener noreferrer">here</a>. Any changes to that will be noted in the <a href="https://github.com/nasa/cumulus/releases" target="_blank" rel="noopener noreferrer">release notes</a>.</p><p>To verify your Terraform version, run:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ terraform --version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Terraform v0.13.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="credentials">Credentials<a href="#credentials" class="hash-link" aria-label="Direct link to Credentials" title="Direct link to Credentials">​</a></h3><ul><li><a href="https://earthdata.nasa.gov/about/science-system-description/eosdis-components/common-metadata-repository" target="_blank" rel="noopener noreferrer">CMR</a> username and password. CMR credentials must be provided if you are exporting metadata to CMR with Earthdata Login authentication.</li><li><a href="https://launchpad.nasa.gov" target="_blank" rel="noopener noreferrer">NASA Launchpad</a>. Launchpad credentials must be provided if you are using Launchpad authentication to export metadata to CMR or to authenticate with the Cumulus API.</li><li><a href="https://earthdata.nasa.gov/about/science-system-description/eosdis-components/earthdata-login" target="_blank" rel="noopener noreferrer">Earthdata Login</a> username and password. User must have the ability to administer and/or create applications in URS. It&#x27;s recommended to obtain an account in the test environment (UAT).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="needed-git-repositories">Needed Git Repositories<a href="#needed-git-repositories" class="hash-link" aria-label="Direct link to Needed Git Repositories" title="Direct link to Needed Git Repositories">​</a></h3><ul><li><a href="https://github.com/nasa/cumulus-template-deploy" target="_blank" rel="noopener noreferrer">Cumulus Deployment Template</a></li><li><a href="https://github.com/nasa/cumulus-dashboard" target="_blank" rel="noopener noreferrer">Cumulus Dashboard</a></li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-deployment-repository">Prepare Deployment Repository<a href="#prepare-deployment-repository" class="hash-link" aria-label="Direct link to Prepare Deployment Repository" title="Direct link to Prepare Deployment Repository">​</a></h2><blockquote><p><em>If you already are working with an existing repository that is configured appropriately for the version of Cumulus you intend to deploy or update, skip to <a href="#prepare-aws-configuration">Prepare AWS configuration.</a></em></p></blockquote><p>Clone the <a href="https://github.com/nasa/cumulus-template-deploy" target="_blank" rel="noopener noreferrer"><code>cumulus-template-deploy</code></a> repo and name appropriately for your organization:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/nasa/cumulus-template-deploy </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">repository-name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We will return to <a href="#deploy-the-cumulus-instance">configuring this repo and using it for deployment below</a>.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Optional: Create a new repository</summary><div><div class="collapsibleContent_i85q"><p>  <a href="https://help.github.com/articles/creating-a-new-repository/" target="_blank" rel="noopener noreferrer">Create a new repository</a> on Github so that you can add your workflows and other modules to source control:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> remote set-url origin https://github.com/nasa/</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">repository-name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> push origin master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can then <a href="https://help.github.com/articles/adding-a-file-to-a-repository-using-the-command-line/" target="_blank" rel="noopener noreferrer">add/commit</a> changes as needed.</p><blockquote><p>⚠️ <strong>Note</strong>: If you are pushing your deployment code to a git repo, make sure to add <code>terraform.tf</code> and <code>terraform.tfvars</code> to <code>.gitignore</code>, <strong>as these files will contain sensitive data related to your AWS account</strong>.</p></blockquote></div></div></details><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-aws-configuration">Prepare AWS Configuration<a href="#prepare-aws-configuration" class="hash-link" aria-label="Direct link to Prepare AWS Configuration" title="Direct link to Prepare AWS Configuration">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-access-keys">Set Access Keys<a href="#set-access-keys" class="hash-link" aria-label="Direct link to Set Access Keys" title="Direct link to Set Access Keys">​</a></h3><p>You need to make some AWS information available to your environment. If you don&#x27;t already have the access key and secret access key of an AWS user with IAM Create-User permissions, you must <a href="https://docs.aws.amazon.com/general/latest/gr/managing-aws-access-keys.html" target="_blank" rel="noopener noreferrer">create access keys</a> for such a user with IAM Create-User permissions, then export the access keys:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">AWS access key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">AWS secret key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">AWS_REGION</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">region</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you don&#x27;t want to set environment variables, <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html" target="_blank" rel="noopener noreferrer">access keys can be stored locally via the AWS CLI.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-s3-buckets">Create S3 Buckets<a href="#create-s3-buckets" class="hash-link" aria-label="Direct link to Create S3 Buckets" title="Direct link to Create S3 Buckets">​</a></h3><p>See <a href="/cumulus/docs/v14.1.0/deployment/create_bucket">creating S3 buckets</a> for more information on how to create a bucket.</p><p>The following S3 bucket should be created (replacing <code>&lt;prefix&gt;</code> with whatever you&#x27;d like, generally your organization/DAAC&#x27;s name):</p><ul><li><code>&lt;prefix&gt;-internal</code></li></ul><p>You can create additional S3 buckets based on the needs of your workflows.</p><p>These buckets do not need any non-default permissions to function with Cumulus; however, your local security requirements may vary.</p><blockquote><p>⚠️ <strong>Note</strong>: S3 bucket object names are global and must be unique across all accounts/locations/etc.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-subnets-and-security-group">VPC, Subnets, and Security Group<a href="#vpc-subnets-and-security-group" class="hash-link" aria-label="Direct link to VPC, Subnets, and Security Group" title="Direct link to VPC, Subnets, and Security Group">​</a></h3><p>Cumulus supports operation within a VPC, but you will need to separately create:</p><ul><li>VPC</li><li>Subnet</li><li>Security group</li><li>VPC endpoints for the various services used by Cumulus if you wish to route traffic through the VPC</li></ul><p>These resources only need to be created once per AWS account and their IDs will be used to configure your Terraform deployment.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="elasticsearch-in-a-vpc">Elasticsearch in a VPC<a href="#elasticsearch-in-a-vpc" class="hash-link" aria-label="Direct link to Elasticsearch in a VPC" title="Direct link to Elasticsearch in a VPC">​</a></h4><p>Amazon Elasticsearch Service (ES) does not use a VPC Endpoint. To use ES within a VPC, before deploying run:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws iam create-service-linked-role --aws-service-name es.amazonaws.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This operation only needs to be done once per account, but it must be done for both NGAP and regular AWS environments.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="look-up-ecs-optimized-ami-deprecated">Look Up ECS-optimized AMI (DEPRECATED)<a href="#look-up-ecs-optimized-ami-deprecated" class="hash-link" aria-label="Direct link to Look Up ECS-optimized AMI (DEPRECATED)" title="Direct link to Look Up ECS-optimized AMI (DEPRECATED)">​</a></h3><blockquote><p>⚠️ <strong>Note:</strong> This step is unnecessary if you using the latest changes in the <a href="https://github.com/nasa/cumulus-template-deploy/commit/8472e2f3a7185d77bb68bf9e0f21a92a91b0cba9" target="_blank" rel="noopener noreferrer"><code>cumulus-template-deploy</code> repo which will automatically determine the AMI ID for you
based on your <code>deploy_to_ngap</code> variable</a>.</p></blockquote><p>Look up the recommended machine image ID for the Linux version and AWS region of your deployment. See <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-optimized_AMI.html#ecs-optimized-ami-linux" target="_blank" rel="noopener noreferrer">Linux Amazon ECS-optimized AMIs docs</a>. The image ID, beginning with <code>ami-</code>, will be assigned to the <code>ecs_cluster_instance_image_id</code> variable for the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf" target="_blank" rel="noopener noreferrer">cumulus-tf module</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-ec2-key-pair-optional">Set Up EC2 Key Pair (Optional)<a href="#set-up-ec2-key-pair-optional" class="hash-link" aria-label="Direct link to Set Up EC2 Key Pair (Optional)" title="Direct link to Set Up EC2 Key Pair (Optional)">​</a></h3><p>The key pair will be used to SSH into your EC2 instance(s). It is recommended to <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html" target="_blank" rel="noopener noreferrer">create or import a key pair</a> and specify it in your Cumulus deployment.</p><p>This can also be done post-deployment by redeploying your Cumulus instance.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-earthdata-application">Configure Earthdata Application<a href="#configure-earthdata-application" class="hash-link" aria-label="Direct link to Configure Earthdata Application" title="Direct link to Configure Earthdata Application">​</a></h2><p>The Cumulus stack can authenticate with <a href="https://urs.earthdata.nasa.gov/documentation" target="_blank" rel="noopener noreferrer">Earthdata Login</a>. If you want to use this functionality, you must create and register a new Earthdata application. Use the <a href="https://uat.urs.earthdata.nasa.gov" target="_blank" rel="noopener noreferrer">User Acceptance Tools (UAT) site</a> unless you intend use a different URS environment (which will require updating the <code>urs_url</code> value shown below).</p><p>Follow the directions on <a href="https://wiki.earthdata.nasa.gov/display/EL/How+To+Register+An+Application" target="_blank" rel="noopener noreferrer">how to register an application</a>. Use any url for the <code>Redirect URL</code>, it will be deleted in a later step. Also note the password in Step 3 and client ID in Step 4 use these to replace <code>urs_client_id</code> and <code>urs_client_password</code> in the <code>terraform.tfvars</code> for the <code>cumulus-tf</code> module shown below.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-resources-for-terraform-state">Create Resources for Terraform State<a href="#create-resources-for-terraform-state" class="hash-link" aria-label="Direct link to Create Resources for Terraform State" title="Direct link to Create Resources for Terraform State">​</a></h2><blockquote><p><em>If you&#x27;re re-deploying an existing Cumulus configuration you should skip to <a href="#deploy-the-cumulus-instance">Deploy the Cumulus instance</a>, as these values should already be configured.</em></p></blockquote><p>The state of the Terraform deployment is stored in S3. In the following examples, it will be assumed that state is being stored in a bucket called <code>my-tf-state</code>. You can also use an existing bucket, if desired.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-state-bucket">Create the State Bucket<a href="#create-the-state-bucket" class="hash-link" aria-label="Direct link to Create the State Bucket" title="Direct link to Create the State Bucket">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws s3api create-bucket --bucket my-tf-state</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to help prevent loss of state information, <strong>it is strongly recommended that versioning be enabled on the state bucket</strong>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws s3api put-bucket-versioning </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --bucket my-tf-state </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --versioning-configuration </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">Status</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">Enabled</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>⚠️ <strong>Note:</strong> If your state information does become lost or corrupt, then deployment (via <code>terraform apply</code>) will have unpredictable results, including possible loss of data and loss of deployed resources. In order to reduce your risk of the corruption or loss of your Terraform state file, or otherwise corrupt your Cumulus deployment, please see the <a href="/cumulus/docs/v14.1.0/deployment/terraform-best-practices">Terraform Best Practices</a> guide.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-locks-table">Create the Locks Table<a href="#create-the-locks-table" class="hash-link" aria-label="Direct link to Create the Locks Table" title="Direct link to Create the Locks Table">​</a></h3><p>Terraform uses a lock stored in DynamoDB in order to prevent multiple simultaneous updates. In the following examples, that table will be called <code>my-tf-locks</code>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ aws dynamodb create-table </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --table-name my-tf-locks </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --attribute-definitions </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">AttributeName</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LockID,AttributeType</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">S </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --key-schema </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">AttributeName</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LockID,KeyType</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">HASH </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --billing-mode PAY_PER_REQUEST </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --region us-east-1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-postgresql-database">Configure the PostgreSQL Database<a href="#configure-the-postgresql-database" class="hash-link" aria-label="Direct link to Configure the PostgreSQL Database" title="Direct link to Configure the PostgreSQL Database">​</a></h2><p>Cumulus requires a <a href="/cumulus/docs/v14.1.0/deployment/postgres_database_deployment">PostgreSQL compatible database</a> cluster deployed to AWS. We suggest utilizing <a href="https://docs.aws.amazon.com/rds/index.html" target="_blank" rel="noopener noreferrer">RDS</a>. For further guidance about what type of RDS database to use, please <a href="/cumulus/docs/v14.1.0/deployment/choosing_configuring_rds">see the guide on choosing and configuring your RDS database</a>.</p><p>Cumulus provides a default <a href="/cumulus/docs/v14.1.0/deployment/postgres_database_deployment">template and RDS cluster module</a> utilizing Aurora Serverless.</p><p>However, Core intentionally provides a &quot;bring your own&quot; approach, and any well-planned cluster setup should work, given the following:</p><ul><li>Appropriate testing/evaluation is given to ensure the database capacity will scale and the database deployment will allow access to Cumulus&#x27;s internal components.   Core provides for security-group oriented permissions management via the <code>rds_security_group</code> configuration parameter.</li><li>The database is configured such that its endpoint is accessible from the VPC and subnets configured for the Core deployment.</li><li>An AWS Secrets Manager secret exists that has the following format:</li></ul><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;database&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;databaseName&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;host&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xxx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;password&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;defaultPassword&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;port&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5432</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;username&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xxx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>database</code> -- the PostgreSQL database used by the configured user</li><li><code>host</code> -- the RDS service host for the database in the form (dbClusterIdentifier)-(AWS ID string).(region).rds.amazonaws.com</li><li><code>password</code> -- the database password</li><li><code>port</code> -- The database connection port, should always be 5432</li><li><code>username</code> -- the database username</li></ul><p>This secret should provide access to a PostgreSQL database provisioned on the cluster.</p><p>To configure Cumulus you will need:</p><ul><li>The AWS Secrets Manager ARN for the <em>user</em> Core will write with (e.g. <code>arn:aws:secretsmanager:AWS-REGION:xxxxx:secret:xxxxxxxxxx20210407182709367700000002-dpmpXA</code> ) for use in configuring <code>rds_user_access_secret_arn</code>.</li><li>(Optional) The security group ID that provides access to the cluster to configure <code>rds_security_group</code>.</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-the-cumulus-instance">Deploy the Cumulus Instance<a href="#deploy-the-cumulus-instance" class="hash-link" aria-label="Direct link to Deploy the Cumulus Instance" title="Direct link to Deploy the Cumulus Instance">​</a></h2><p>A typical Cumulus deployment is broken into two
<a href="https://www.terraform.io/docs/configuration/modules.html" target="_blank" rel="noopener noreferrer">Terraform root modules</a>:
<a href="https://github.com/nasa/cumulus/tree/master/tf-modules/data-persistence" target="_blank" rel="noopener noreferrer"><code>data-persistence</code></a> and <a href="https://github.com/nasa/cumulus/tree/master/tf-modules/cumulus" target="_blank" rel="noopener noreferrer"><code>cumulus</code></a>.</p><p>The <code>data-persistence</code> module should be deployed first. This module creates the Elasticsearch domain, DynamoDB tables, RDS database tables, and performs any structural updates needed on the RDS tables via migrations. During the RDS migration, duplicate tables will be deployed by the <code>data-persistence</code> module in both DynamoDB and the RDS database. The <code>cumulus</code> module deploys the rest of Cumulus: distribution, API, ingest, workflows, etc. The <code>cumulus</code> module depends on the resources created in the <code>data-persistence</code> deployment.</p><p>Each of these modules have to be deployed independently and require their own Terraform backend, variable, and output settings. The template deploy repo that was cloned previously already contains the scaffolding of the necessary files for the deployment of each module: <code>data-persistence-tf</code> deploys the <code>data-persistence</code> module and <code>cumulus-tf</code> deploys the <code>cumulus</code> module. For reference on the files that are included, see the <a href="/cumulus/docs/v14.1.0/deployment/components#adding-components-to-your-terraform-deployment">documentation on adding components to a Terraform deployment</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h3><p>Please see our <a href="/cumulus/docs/v14.1.0/troubleshooting/troubleshooting-deployment">troubleshooting documentation for any issues with your deployment</a> when performing the upcoming steps.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-and-deploy-the-data-persistence-tf-root-module">Configure and Deploy the <code>data-persistence-tf</code> Root Module<a href="#configure-and-deploy-the-data-persistence-tf-root-module" class="hash-link" aria-label="Direct link to configure-and-deploy-the-data-persistence-tf-root-module" title="Direct link to configure-and-deploy-the-data-persistence-tf-root-module">​</a></h3><p>These steps should be executed in the <code>data-persistence-tf</code> directory of the template deploy repo that you previously cloned. Run the following to copy the example files.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> data-persistence-tf/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> terraform.tf.example terraform.tf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> terraform.tfvars.example terraform.tfvars</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In <code>terraform.tf</code>, configure the remote state settings by substituting the appropriate values for:</p><ul><li><code>bucket</code></li><li><code>dynamodb_table</code></li><li><code>PREFIX</code> (whatever prefix you&#x27;ve chosen for your deployment)</li></ul><p>Fill in the appropriate values in <code>terraform.tfvars</code>. See the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/data-persistence/variables.tf" target="_blank" rel="noopener noreferrer"><code>data-persistence</code> module variable definitions</a> for more detail on each variable.</p><p>Consider <a href="#elasticsearch">the size of your Elasticsearch cluster</a> when configuring <code>data-persistence</code>.</p><p><strong>Reminder:</strong> <em>Elasticsearch is optional and can be disabled using <code>include_elasticsearch = false</code> in your <code>terraform.tfvars</code>. Your Cumulus Dashboard will not work without Elasticsearch.</em></p><p><strong>Reminder:</strong> <em>If you are including <code>subnet_ids</code> in your <code>terraform.tfvars</code>, Elasticsearch will need a service-linked role to deploy successfully. Follow the <a href="#elasticsearch-in-a-vpc">instructions above</a> to create the service-linked role if you haven&#x27;t already.</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="initialize-terraform">Initialize Terraform<a href="#initialize-terraform" class="hash-link" aria-label="Direct link to Initialize Terraform" title="Direct link to Initialize Terraform">​</a></h4><p>Run <code>terraform init</code><sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup></p><p>You should see an output like:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">* provider.aws: version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;~&gt; 2.32&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Terraform has been successfully initialized</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy">Deploy<a href="#deploy" class="hash-link" aria-label="Direct link to Deploy" title="Direct link to Deploy">​</a></h4><p>Run <code>terraform apply</code> to deploy your data persistence resources. Then type <code>yes</code> when prompted to confirm that you want to create the resources. Assuming the operation is successful, you should see an output like:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Apply complete</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> Resources: </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain"> added, </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> changed, </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> destroyed.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Outputs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dynamo_tables </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;access_tokens&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arn&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arn:aws:dynamodb:us-east-1:12345:table/prefix-AccessTokensTable&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;prefix-AccessTokensTable&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ... more tables ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elasticsearch_alarms </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arn&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arn:aws:cloudwatch:us-east-1:12345:alarm:prefix-es-vpc-NodesLowAlarm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;prefix-es-vpc-NodesLowAlarm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ... more alarms ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elasticsearch_domain_arn </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> arn:aws:es:us-east-1:12345:domain/prefix-es-vpc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elasticsearch_hostname </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> vpc-prefix-es-vpc-abcdef.us-east-1.es.amazonaws.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elasticsearch_security_group_id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sg-12345</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Your data persistence resources are now deployed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-the-cumulus-message-adapter-layer-deprecated">Deploy the Cumulus Message Adapter Layer (DEPRECATED)<a href="#deploy-the-cumulus-message-adapter-layer-deprecated" class="hash-link" aria-label="Direct link to Deploy the Cumulus Message Adapter Layer (DEPRECATED)" title="Direct link to Deploy the Cumulus Message Adapter Layer (DEPRECATED)">​</a></h3><blockquote><p>⚠️ <strong>Note:</strong> This step is unnecessary if you using the latest changes in the <a href="https://github.com/nasa/cumulus-template-deploy/commit/8472e2f3a7185d77bb68bf9e0f21a92a91b0cba9" target="_blank" rel="noopener noreferrer"><code>cumulus-template-deploy</code> repo which will automatically download the Cumulus Message Adapter and create the layer for you based on your <code>cumulus_message_adapter_version</code> variable</a>.</p></blockquote><p>The <a href="/cumulus/docs/v14.1.0/workflows/input_output#cumulus-message-adapter">Cumulus Message Adapter (CMA)</a> is necessary for interpreting the input and output of Cumulus workflow steps. The CMA is now integrated with Cumulus workflow steps as a Lambda layer.</p><p>To deploy a CMA layer to your account:</p><ol><li>Go to the <a href="https://github.com/nasa/cumulus-message-adapter/releases" target="_blank" rel="noopener noreferrer">CMA releases page</a> and download the <code>cumulus-message-adapter.zip</code> for the desired release</li><li>Use the AWS CLI to publish your layer:</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ aws lambda publish-layer-version </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --layer-name prefix-CMA-layer </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --region us-east-1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --zip-file fileb:///path/to/cumulus-message-adapter.zip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token function" style="color:rgb(130, 170, 255)">more</span><span class="token plain"> output </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LayerVersionArn&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arn:aws:lambda:us-east-1:1234567890:layer:prefix-CMA-layer:1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token function" style="color:rgb(130, 170, 255)">more</span><span class="token plain"> output </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Make sure to copy the <code>LayerVersionArn</code> of the deployed layer, as it will be used to configure the <code>cumulus-tf</code> deployment in the next step.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-and-deploy-the-cumulus-tf-root-module">Configure and Deploy the <code>cumulus-tf</code> Root Module<a href="#configure-and-deploy-the-cumulus-tf-root-module" class="hash-link" aria-label="Direct link to configure-and-deploy-the-cumulus-tf-root-module" title="Direct link to configure-and-deploy-the-cumulus-tf-root-module">​</a></h3><p>These steps should be executed in the <code>cumulus-tf</code> directory of the template repo that was cloned previously.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cumulus-tf/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> terraform.tf.example terraform.tf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> terraform.tfvars.example terraform.tfvars</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In <code>terraform.tf</code>, configure the remote state settings by substituting the appropriate values for:</p><ul><li><code>bucket</code></li><li><code>dynamodb_table</code></li><li><code>PREFIX</code> (whatever prefix you&#x27;ve chosen for your deployment)</li></ul><p>Fill in the appropriate values in <code>terraform.tfvars</code>. See the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf" target="_blank" rel="noopener noreferrer">Cumulus module variable definitions</a> for more detail on each variable.</p><p>Notes on specific variables:</p><ul><li><strong><code>deploy_to_ngap</code></strong>: This variable controls the provisioning of certain resources and policies that are specific to an NGAP environment. <strong>If you are deploying to NGAP, you must set this variable to <code>true</code>.</strong></li><li><strong><code>prefix</code></strong>: The value should be the same as the <code>prefix</code> from the data-persistence deployment.</li><li><strong><code>data_persistence_remote_state_config</code></strong>: This object should contain the remote state values that you configured in <code>data-persistence-tf/terraform.tf</code>. These settings allow <code>cumulus-tf</code> to determine the names of the resources created in <code>data-persistence-tf</code>.</li><li><strong><code>rds_security_group</code></strong>: The ID of the security group used to allow access to the PostgreSQL database</li><li><strong><code>rds_user_access_secret_arn</code></strong>: The ARN for the Secrets Manager secret that provides database access information</li><li><strong><code>cumulus_message_adapter_version</code></strong>: The version number (e.g. <code>1.3.0</code>) of the <a href="https://github.com/nasa/cumulus-message-adapter/releases" target="_blank" rel="noopener noreferrer">Cumulus Message Adapter</a> to deploy</li><li><strong><code>key_name</code> (optional)</strong>: The name of your key pair from <a href="#set-up-ec2-key-pair-optional">setting up your key pair</a>. Adding your <code>key_name</code> sets the EC2 keypair
for deployment&#x27;s EC2 instances and allows you to connect to them via <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-sessions-start.html" target="_blank" rel="noopener noreferrer">SSH/SSM</a>.</li></ul><p>Consider <a href="#cumulus-instance-sizing">the sizing of your Cumulus instance</a> when configuring your variables.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="choose-a-distribution-api">Choose a Distribution API<a href="#choose-a-distribution-api" class="hash-link" aria-label="Direct link to Choose a Distribution API" title="Direct link to Choose a Distribution API">​</a></h3><p>Cumulus can be configured to use either the Thin Egress App (TEA) or the Cumulus Distribution API. The default selection is the Thin Egress App if you&#x27;re using the <a href="https://github.com/nasa/cumulus-template-deploy" target="_blank" rel="noopener noreferrer">Deployment Template</a>.</p><blockquote><p>⚠️ <strong>IMPORTANT:</strong> If you already have a deployment using the TEA distribution and want to switch to Cumulus Distribution, there will be an API Gateway change. This means that there will be downtime while you update your CloudFront endpoint to use
the new API gateway.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-thin-egress-app">Configure the Thin Egress App<a href="#configure-the-thin-egress-app" class="hash-link" aria-label="Direct link to Configure the Thin Egress App" title="Direct link to Configure the Thin Egress App">​</a></h4><p>TEA can be used for Cumulus distribution and is the default selection. It allows authentication using Earthdata Login. Follow the steps <a href="/cumulus/docs/v14.1.0/deployment/thin_egress_app">in the TEA documentation</a> to configure distribution in your <code>cumulus-tf</code> deployment.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-cumulus-distribution-api-optional">Configure the Cumulus Distribution API (Optional)<a href="#configure-the-cumulus-distribution-api-optional" class="hash-link" aria-label="Direct link to Configure the Cumulus Distribution API (Optional)" title="Direct link to Configure the Cumulus Distribution API (Optional)">​</a></h4><p>If you would prefer to use the Cumulus Distribution API, which supports <a href="https://aws.amazon.com/cognito/" target="_blank" rel="noopener noreferrer">AWS Cognito authentication</a>, follow <a href="/cumulus/docs/v14.1.0/deployment/cumulus_distribution">these steps</a> to configure distribution in your <code>cumulus-tf</code> deployment.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initialize-terraform-1">Initialize Terraform<a href="#initialize-terraform-1" class="hash-link" aria-label="Direct link to Initialize Terraform" title="Direct link to Initialize Terraform">​</a></h3><p>Follow the <a href="#initialize-terraform">above instructions to initialize Terraform</a> using <code>terraform init</code><sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-1">Deploy<a href="#deploy-1" class="hash-link" aria-label="Direct link to Deploy" title="Direct link to Deploy">​</a></h3><p>Run <code>terraform apply</code> to deploy the resources. Type <code>yes</code> when prompted to confirm that you want to create the resources. Assuming the operation is successful, you should see output like this:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Apply complete</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> Resources: </span><span class="token number" style="color:rgb(247, 140, 108)">292</span><span class="token plain"> added, </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> changed, </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> destroyed.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Outputs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">archive_api_redirect_uri </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> https://abc123.execute-api.us-east-1.amazonaws.com/dev/token</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">archive_api_uri </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> https://abc123.execute-api.us-east-1.amazonaws.com/dev/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">distribution_redirect_uri </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> https://abc123.execute-api.us-east-1.amazonaws.com/DEV/login</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">distribution_url </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> https://abc123.execute-api.us-east-1.amazonaws.com/DEV/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>⚠️ <strong>Note:</strong> Be sure to copy the redirect URLs because you will need them to update your Earthdata application.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-earthdata-application">Update Earthdata Application<a href="#update-earthdata-application" class="hash-link" aria-label="Direct link to Update Earthdata Application" title="Direct link to Update Earthdata Application">​</a></h3><p>Add the two redirect URLs to your EarthData login application by doing the following:</p><ol><li>Login to URS</li><li>Under My Applications -&gt; Application Administration -&gt; use the edit icon of your application</li><li>Under Manage -&gt; redirect URIs, add the Archive API url returned from the stack deployment<ul><li>e.g. <code>archive_api_redirect_uri = https://&lt;czbbkscuy6&gt;.execute-api.us-east-1.amazonaws.com/dev/token</code></li></ul></li><li>Also add the Distribution url<ul><li>e.g. <code>distribution_redirect_uri = https://&lt;kido2r7kji&gt;.execute-api.us-east-1.amazonaws.com/dev/login</code><sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup></li></ul></li><li>You may delete the placeholder url you used to create the application</li></ol><p>If you&#x27;ve lost track of the needed redirect URIs, they can be located on the <a href="https://console.aws.amazon.com/apigateway" target="_blank" rel="noopener noreferrer">API Gateway</a>. Once there, select <code>&lt;prefix&gt;-archive</code> and/or <code>&lt;prefix&gt;-thin-egress-app-EgressGateway</code>, <code>Dashboard</code> and utilizing the base URL at the top of the page that is accompanied by the text <code>Invoke this API at:</code>. Make sure to append <code>/token</code> for the archive URL and <code>/login</code> to the thin egress app URL.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-cumulus-dashboard">Deploy Cumulus Dashboard<a href="#deploy-cumulus-dashboard" class="hash-link" aria-label="Direct link to Deploy Cumulus Dashboard" title="Direct link to Deploy Cumulus Dashboard">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dashboard-requirements">Dashboard Requirements<a href="#dashboard-requirements" class="hash-link" aria-label="Direct link to Dashboard Requirements" title="Direct link to Dashboard Requirements">​</a></h3><p>Please note that the requirements are similar to the <a href="#requirements">Cumulus stack deployment requirements</a>. The installation instructions below include a step that will install/use the required node version referenced in the <code>.nvmrc</code> file in the Dashboard repository.</p><ul><li>git</li><li><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">node 12.18</a> (use <a href="https://github.com/creationix/nvm" target="_blank" rel="noopener noreferrer">nvm</a> to upgrade/downgrade)</li><li><a href="https://www.npmjs.com/get-npm" target="_blank" rel="noopener noreferrer">npm</a></li><li>zip</li><li>AWS CLI - <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS Command Line Interface</a></li><li>python</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-aws">Prepare AWS<a href="#prepare-aws" class="hash-link" aria-label="Direct link to Prepare AWS" title="Direct link to Prepare AWS">​</a></h3><p><strong>Create S3 Bucket for Dashboard:</strong></p><ul><li>Create it, e.g. <code>&lt;prefix&gt;-dashboard</code>. Use the command line or console as you did when <a href="#prepare-aws-configuration">preparing AWS configuration</a>.</li><li>Configure the bucket to host a website:<ul><li>AWS S3 console: Select <code>&lt;prefix&gt;-dashboard</code> bucket then, &quot;Properties&quot; -&gt; &quot;Static Website Hosting&quot;, point to <code>index.html</code></li><li>CLI: <code>aws s3 website s3://&lt;prefix&gt;-dashboard --index-document index.html</code></li></ul></li><li>The bucket&#x27;s url will be <code>http://&lt;prefix&gt;-dashboard.s3-website-&lt;region&gt;.amazonaws.com</code> or you can find it on the AWS console via &quot;Properties&quot; -&gt; &quot;Static website hosting&quot; -&gt; &quot;Endpoint&quot;</li><li>Ensure the bucket&#x27;s access permissions allow your deployment user access to write to the bucket</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-dashboard">Install Dashboard<a href="#install-dashboard" class="hash-link" aria-label="Direct link to Install Dashboard" title="Direct link to Install Dashboard">​</a></h3><p>To install the Cumulus Dashboard, clone the <a href="https://github.com/nasa/cumulus-dashboard" target="_blank" rel="noopener noreferrer">repository</a> into the root <code>deploy</code> directory and install dependencies with <code>npm install</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/nasa/cumulus-dashboard</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cumulus-dashboard</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  nvm use</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you do not have the correct version of node installed, replace <code>nvm use</code> with <code>nvm install $(cat .nvmrc)</code> in the above example.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dashboard-versioning">Dashboard Versioning<a href="#dashboard-versioning" class="hash-link" aria-label="Direct link to Dashboard Versioning" title="Direct link to Dashboard Versioning">​</a></h4><p>By default, the <code>master</code> branch will be used for Dashboard deployments. The <code>master</code> branch of the repository contains the most recent stable release of the Cumulus Dashboard.</p><p>If you want to test unreleased changes to the Dashboard, use the <code>develop</code> branch.</p><p>Each <a href="https://github.com/nasa/cumulus-dashboard/releases" target="_blank" rel="noopener noreferrer">release/version of the Dashboard</a> will have <a href="https://github.com/nasa/cumulus-dashboard/tags" target="_blank" rel="noopener noreferrer">a tag in the Dashboard repo</a>. Release/version numbers will use semantic versioning (major/minor/patch).</p><p>To checkout and install a specific version of the Dashboard:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> fetch --tags</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> checkout </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">version-number</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># e.g. v1.2.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  nvm use</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you do not have the correct version of node installed, replace <code>nvm use</code> with <code>nvm install $(cat .nvmrc)</code> in the above example.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-the-dashboard">Building the Dashboard<a href="#building-the-dashboard" class="hash-link" aria-label="Direct link to Building the Dashboard" title="Direct link to Building the Dashboard">​</a></h3><blockquote><p>⚠️ <strong>Note</strong>: These environment variables are available during the build: <code>APIROOT</code>, <code>DAAC_NAME</code>, <code>STAGE</code>, <code>HIDE_PDR</code>. Any of these can be set on the command line to override the values contained in <code>config.js</code> when running the build below.</p></blockquote><p>To configure your dashboard for deployment, set the <code>APIROOT</code> environment variable to your app&#x27;s API root.<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup></p><p>Build your dashboard from the Cumulus Dashboard repository root directory, <code>cumulus-dashboard</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">APIROOT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">your_api_root</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dashboard-deployment">Dashboard Deployment<a href="#dashboard-deployment" class="hash-link" aria-label="Direct link to Dashboard Deployment" title="Direct link to Dashboard Deployment">​</a></h3><p>Deploy your dashboard to S3 bucket from the <code>cumulus-dashboard</code> directory:</p><p>Using AWS CLI:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  aws s3 </span><span class="token function" style="color:rgb(130, 170, 255)">sync</span><span class="token plain"> dist s3://</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">prefix</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">-dashboard --acl public-read</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the S3 Console:</p><ul><li>Open the <code>&lt;prefix&gt;-dashboard</code> bucket, click &#x27;upload&#x27;. Add the contents of the &#x27;dist&#x27; subdirectory to the upload. Then select &#x27;Next&#x27;. On the permissions window allow the public to view. Select &#x27;Upload&#x27;.</li></ul><p>You should be able to visit the Dashboard website at <code>http://&lt;prefix&gt;-dashboard.s3-website-&lt;region&gt;.amazonaws.com</code> or find the url
<code>&lt;prefix&gt;-dashboard</code> -&gt; &quot;Properties&quot; -&gt; &quot;Static website hosting&quot; -&gt; &quot;Endpoint&quot; and log in with a user that you had previously configured for access.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cumulus-instance-sizing">Cumulus Instance Sizing<a href="#cumulus-instance-sizing" class="hash-link" aria-label="Direct link to Cumulus Instance Sizing" title="Direct link to Cumulus Instance Sizing">​</a></h2><p>The Cumulus deployment default sizing for Elasticsearch instances, EC2 instances, and Autoscaling Groups are small and designed for testing and cost savings. The default settings are likely not suitable for production workloads. Sizing is highly individual and dependent on expected load and archive size.</p><blockquote><p>Please be cognizant of costs as any change in size will affect your AWS bill. AWS provides a <a href="https://calculator.aws/#/" target="_blank" rel="noopener noreferrer">pricing calculator</a> for estimating costs.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="elasticsearch">Elasticsearch<a href="#elasticsearch" class="hash-link" aria-label="Direct link to Elasticsearch" title="Direct link to Elasticsearch">​</a></h3><p>The <a href="https://github.com/nasa/cumulus/blob/master/packages/es-client/config/mappings.json" target="_blank" rel="noopener noreferrer">mappings file</a> contains all of the data types that will be indexed into Elasticsearch. Elasticsearch sizing is tied to your archive size, including your collections, granules, and workflow executions that will be stored.</p><p>AWS provides <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/sizing-domains.html" target="_blank" rel="noopener noreferrer">documentation</a> on calculating and configuring for sizing.</p><p>In addition to size you&#x27;ll want to consider the <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-managedomains-dedicatedmasternodes.html" target="_blank" rel="noopener noreferrer">number of nodes</a> which determine how the system reacts in the event of a failure.</p><p>Configuration can be done in the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/data-persistence/variables.tf#L16" target="_blank" rel="noopener noreferrer">data persistence module</a> in <code>elasticsearch_config</code> and the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf#L541" target="_blank" rel="noopener noreferrer">cumulus module</a> in <code>es_index_shards</code>.</p><blockquote><p>If you make changes to your Elasticsearch configuration you will need to <a href="/cumulus/docs/v14.1.0/troubleshooting/reindex-elasticsearch">reindex</a> for those changes to take effect.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ec2-instances-and-autoscaling-groups">EC2 Instances and Autoscaling Groups<a href="#ec2-instances-and-autoscaling-groups" class="hash-link" aria-label="Direct link to EC2 Instances and Autoscaling Groups" title="Direct link to EC2 Instances and Autoscaling Groups">​</a></h3><p>EC2 instances are used for long-running operations (i.e. generating a reconciliation report) and long-running workflow tasks. Configuration for your ECS cluster is achieved via <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf" target="_blank" rel="noopener noreferrer">Cumulus deployment variables</a>.</p><p>When configuring your ECS cluster consider:</p><ul><li>The <a href="https://aws.amazon.com/ec2/instance-types/" target="_blank" rel="noopener noreferrer">EC2 instance type</a> and <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/volume_constraints.html" target="_blank" rel="noopener noreferrer">EBS volume size</a> needed to accommodate your workloads. Configured as <code>ecs_cluster_instance_type</code> and <code>ecs_cluster_instance_docker_volume_size</code>.</li><li>The minimum and desired number of instances on hand to accommodate your workloads. Configured as <code>ecs_cluster_min_size</code> and <code>ecs_cluster_desired_size</code>.</li><li>The maximum number of instances you will need and are willing to pay for to accommodate your heaviest workloads. Configured as <code>ecs_cluster_max_size</code>.</li><li>Your autoscaling parameters: <code>ecs_cluster_scale_in_adjustment_percent</code>, <code>ecs_cluster_scale_out_adjustment_percent</code>, <code>ecs_cluster_scale_in_threshold_percent</code>, and <code>ecs_cluster_scale_out_threshold_percent</code>.</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="footnotes">Footnotes<a href="#footnotes" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2><div class="footnotes"><hr><ol><li id="fn-3"><p>Run <code>terraform init</code> if:</p><ul><li>This is the first time deploying the module</li><li>You have added any additional child modules, including <a href="/cumulus/docs/v14.1.0/deployment/components#available-cumulus-components">Cumulus components</a></li><li>You have updated the <code>source</code> for any of the child modules</li></ul><p><a href="#fnref-3" class="footnote-backref">↩</a></p></li><li id="fn-1"><p>To add another redirect URIs to your application. On Earthdata home page, select &quot;My Applications&quot;. Scroll down to &quot;Application Administration&quot; and use the edit icon for your application. Then Manage -&gt; Redirect URIs.<a href="#fnref-1" class="footnote-backref">↩</a></p></li><li id="fn-2"><p>The API root can be found a number of ways. The easiest is to note it in the output of the app deployment step. But you can also find it from the <code>AWS console -&gt; Amazon API Gateway -&gt; APIs -&gt; &lt;prefix&gt;-archive -&gt; Dashboard</code>, and reading the URL at the top after &quot;Invoke this API at&quot;<a href="#fnref-2" class="footnote-backref">↩</a></p></li></ol></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-03-10T00:04:48.000Z">Mar 10, 2023</time></b> by <b>jennyhliu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cumulus/docs/v14.1.0/workflows/workflow-triggers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Workflow Triggers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cumulus/docs/v14.1.0/deployment/create_bucket"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Creating an S3 Bucket</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href="#linuxmacos-software-requirements" class="table-of-contents__link toc-highlight">Linux/MacOS Software Requirements</a></li><li><a href="#install-terraform" class="table-of-contents__link toc-highlight">Install Terraform</a></li><li><a href="#credentials" class="table-of-contents__link toc-highlight">Credentials</a></li><li><a href="#needed-git-repositories" class="table-of-contents__link toc-highlight">Needed Git Repositories</a></li></ul></li><li><a href="#prepare-deployment-repository" class="table-of-contents__link toc-highlight">Prepare Deployment Repository</a></li><li><a href="#prepare-aws-configuration" class="table-of-contents__link toc-highlight">Prepare AWS Configuration</a><ul><li><a href="#set-access-keys" class="table-of-contents__link toc-highlight">Set Access Keys</a></li><li><a href="#create-s3-buckets" class="table-of-contents__link toc-highlight">Create S3 Buckets</a></li><li><a href="#vpc-subnets-and-security-group" class="table-of-contents__link toc-highlight">VPC, Subnets, and Security Group</a></li><li><a href="#look-up-ecs-optimized-ami-deprecated" class="table-of-contents__link toc-highlight">Look Up ECS-optimized AMI (DEPRECATED)</a></li><li><a href="#set-up-ec2-key-pair-optional" class="table-of-contents__link toc-highlight">Set Up EC2 Key Pair (Optional)</a></li></ul></li><li><a href="#configure-earthdata-application" class="table-of-contents__link toc-highlight">Configure Earthdata Application</a></li><li><a href="#create-resources-for-terraform-state" class="table-of-contents__link toc-highlight">Create Resources for Terraform State</a><ul><li><a href="#create-the-state-bucket" class="table-of-contents__link toc-highlight">Create the State Bucket</a></li><li><a href="#create-the-locks-table" class="table-of-contents__link toc-highlight">Create the Locks Table</a></li></ul></li><li><a href="#configure-the-postgresql-database" class="table-of-contents__link toc-highlight">Configure the PostgreSQL Database</a></li><li><a href="#deploy-the-cumulus-instance" class="table-of-contents__link toc-highlight">Deploy the Cumulus Instance</a><ul><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#configure-and-deploy-the-data-persistence-tf-root-module" class="table-of-contents__link toc-highlight">Configure and Deploy the <code>data-persistence-tf</code> Root Module</a></li><li><a href="#deploy-the-cumulus-message-adapter-layer-deprecated" class="table-of-contents__link toc-highlight">Deploy the Cumulus Message Adapter Layer (DEPRECATED)</a></li><li><a href="#configure-and-deploy-the-cumulus-tf-root-module" class="table-of-contents__link toc-highlight">Configure and Deploy the <code>cumulus-tf</code> Root Module</a></li><li><a href="#choose-a-distribution-api" class="table-of-contents__link toc-highlight">Choose a Distribution API</a></li><li><a href="#initialize-terraform-1" class="table-of-contents__link toc-highlight">Initialize Terraform</a></li><li><a href="#deploy-1" class="table-of-contents__link toc-highlight">Deploy</a></li><li><a href="#update-earthdata-application" class="table-of-contents__link toc-highlight">Update Earthdata Application</a></li></ul></li><li><a href="#deploy-cumulus-dashboard" class="table-of-contents__link toc-highlight">Deploy Cumulus Dashboard</a><ul><li><a href="#dashboard-requirements" class="table-of-contents__link toc-highlight">Dashboard Requirements</a></li><li><a href="#prepare-aws" class="table-of-contents__link toc-highlight">Prepare AWS</a></li><li><a href="#install-dashboard" class="table-of-contents__link toc-highlight">Install Dashboard</a></li><li><a href="#building-the-dashboard" class="table-of-contents__link toc-highlight">Building the Dashboard</a></li><li><a href="#dashboard-deployment" class="table-of-contents__link toc-highlight">Dashboard Deployment</a></li></ul></li><li><a href="#cumulus-instance-sizing" class="table-of-contents__link toc-highlight">Cumulus Instance Sizing</a><ul><li><a href="#elasticsearch" class="table-of-contents__link toc-highlight">Elasticsearch</a></li><li><a href="#ec2-instances-and-autoscaling-groups" class="table-of-contents__link toc-highlight">EC2 Instances and Autoscaling Groups</a></li></ul></li><li><a href="#footnotes" class="table-of-contents__link toc-highlight">Footnotes</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/cumulus/assets/js/runtime~main.6d34a879.js"></script>
<script src="/cumulus/assets/js/main.1257b213.js"></script>
</body>
</html>