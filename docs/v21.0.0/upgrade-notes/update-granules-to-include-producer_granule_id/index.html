<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v21.0.0 plugin-docs plugin-id-default docs-doc-id-upgrade-notes/update-granules-to-include-producer_granule_id" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Update granules to include producer_granule_id | Cumulus Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nasa.github.io/cumulus/docs/v21.0.0/upgrade-notes/update-granules-to-include-producer_granule_id"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v21.0.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v21.0.0"><meta data-rh="true" name="docsearch:version" content="v21.0.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v21.0.0"><meta data-rh="true" property="og:title" content="Update granules to include producer_granule_id | Cumulus Documentation"><meta data-rh="true" name="description" content="Background"><meta data-rh="true" property="og:description" content="Background"><link data-rh="true" rel="icon" href="/cumulus/img/cumulus.ico"><link data-rh="true" rel="canonical" href="https://nasa.github.io/cumulus/docs/v21.0.0/upgrade-notes/update-granules-to-include-producer_granule_id"><link data-rh="true" rel="alternate" href="https://nasa.github.io/cumulus/docs/v21.0.0/upgrade-notes/update-granules-to-include-producer_granule_id" hreflang="en"><link data-rh="true" rel="alternate" href="https://nasa.github.io/cumulus/docs/v21.0.0/upgrade-notes/update-granules-to-include-producer_granule_id" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBWSJQ0LBW-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Cumulus Documentation" href="/cumulus/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/cumulus/assets/css/styles.4f54c3bd.css">
<link rel="preload" href="/cumulus/assets/js/runtime~main.682a3672.js" as="script">
<link rel="preload" href="/cumulus/assets/js/main.52adefda.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cumulus/"><div class="navbar__logo"><img src="/cumulus/img/ic_cumulus_logo_white.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA" height="32" width="32"><img src="/cumulus/img/ic_cumulus_logo_white.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU" height="32" width="32"></div><b class="navbar__title text--truncate">Cumulus Documentation</b></a><a href="https://nasa.github.io/cumulus-api" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://nasa.github.io/cumulus-distribution-api" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Distribution API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus/docs/v21.0.0/">Developer Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus/docs/v21.0.0/data-cookbooks/about-cookbooks">Data Cookbooks</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus/docs/v21.0.0/operator-docs/about-operator-docs">Operator Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/cumulus/docs/v21.0.0/">v21.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cumulus/docs/next/upgrade-notes/update-granules-to-include-producer_granule_id">Next</a></li><li><a class="dropdown__link" href="/cumulus/docs/upgrade-notes/update-granules-to-include-producer_granule_id">v21.1.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cumulus/docs/v21.0.0/upgrade-notes/update-granules-to-include-producer_granule_id">v21.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v20.3.0/">v20.3.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v20.2.0/">v20.2.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v20.1.2/">v20.1.2</a></li><li><a class="dropdown__link" href="/cumulus/docs/v20.1.1/">v20.1.1</a></li><li><a class="dropdown__link" href="/cumulus/docs/v20.0.0/">v20.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v19.1.0/">v19.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v19.0.0/">v19.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.5.0/">v18.5.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.4.0/">v18.4.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.3.4/">v18.3.4</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.2.0/">v18.2.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.1.0/">v18.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.0.0/">v18.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v17.0.0/">v17.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v16.1.3/">v16.1.3</a></li><li><a class="dropdown__link" href="/cumulus/docs/v16.0.0/">v16.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v15.0.2/">v15.0.2</a></li><li><a class="dropdown__link" href="/cumulus/docs/v14.1.0/">v14.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v13.4.0/">v13.4.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v13.0.0/">v13.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v12.0.0/">v12.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v11.1.0/">v11.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v11.0.0/">v11.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v10.1.0/">v10.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v10.0.0/">v10.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v9.9.0/">v9.9.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v9.0.0/">v9.0.0</a></li><li><hr class="dropdown-separator"></li><li><a class="dropdown__link" href="/cumulus/versions">All versions</a></li></ul></div><a href="https://github.com/nasa/cumulus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="Cumulus Core GitHub Repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/faqs">Frequently Asked Questions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/about-cumulus">About Cumulus</a><button aria-label="Toggle the collapsible sidebar category &#x27;About Cumulus&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/interfaces">Interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/team">Cumulus Team</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/deployment">Deployment</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deployment&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/">How to Deploy Cumulus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/create_bucket">Creating an S3 Bucket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/terraform-best-practices">Terraform Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/components">Component-based Cumulus Deployment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/databases-introduction">Databases</a><button aria-label="Toggle the collapsible sidebar category &#x27;Databases&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/postgres_database_deployment">PostgreSQL Database Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/choosing_configuring_rds">RDS: Choosing and Configuring Your Database Type</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/apis-introduction">APIs</a><button aria-label="Toggle the collapsible sidebar category &#x27;APIs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/thin_egress_app">Using the Thin Egress App (TEA) for Cumulus Distribution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/cumulus_distribution">Using the Cumulus Distribution API</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/cumulus/docs/v21.0.0/category/logs">Logs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Logs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/api-gateway-logging">API Gateway Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/share-s3-access-logs">Share S3 Access Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/cloudwatch-logs-delivery">Configure Cloudwatch Logs Delivery</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/deployment/upgrade-readme">Upgrading Cumulus</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/configuration">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/configuration/data-management-types">Cumulus Data Management Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/configuration/monitoring-readme">Monitoring Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/configuration/server_access_logging">S3 Server Access Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/configuration/cloudwatch-retention">Cloudwatch Retention</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/configuration/lifecycle-policies">Setting S3 Lifecycle Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/configuration/collection-storage-best-practices">Collection Cost Tracking and Storage Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/configuration/task-configuration">Configuration of Tasks</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/development">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/developing-a-cumulus-workflow">Creating a Cumulus Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/developing-workflow-tasks">Developing Workflow Tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/lambda">Develop Lambda Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/docker">Dockerizing Data Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/workflow-configuration-how-to">Workflow Configuration How To&#x27;s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/adding-a-task">Contributing a Task</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/workflows">Workflows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Workflows&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/">Workflows Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/protocol">Workflow Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/input_output">Workflow Inputs &amp; Outputs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/workflow-triggers">Workflow Triggers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/message_granule_writes">Workflow Message Granule Writes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/cumulus/docs/v21.0.0/category/workflow-tasks">Workflow Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Workflow Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/tasks">Cumulus Tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflows/cumulus-task-message-flow">Cumulus Tasks: Message Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflow_tasks/discover_granules">Discover Granules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflow_tasks/files_to_granules">Files To Granules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflow_tasks/move_granules">Move Granules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflow_tasks/queue_granules">Queue Granules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflow_tasks/lzards_backup">LZARDS Backup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/workflow_tasks/parse_pdr">Parse PDR</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/features">Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Features&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/backup_and_restore">Cumulus Backup and Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/dead_letter_queues">Dead Letter Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/dead_letter_archive">Cumulus Dead Letter Archive</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/execution_payload_retention">Execution Payload Retention</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/reports">Reconciliation Reports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/ancillary_metadata">Ancillary Metadata Export</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/distribution-metrics">Cumulus Distribution Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/logging-esdis-metrics">Writing logs for ESDIS Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/record_write_options">Options for writing records to Cumulus datastore during workflow executions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/replay-kinesis-messages">How to replay Kinesis messages after an outage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/replay-archived-sqs-messages">How to replay SQS messages archived in S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/granule_uniquification">Granule Uniquification Feature</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/change_granule_collection">Cumulus Change Granule Collections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/features/record_archival">Database Record Archival</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/troubleshooting">Troubleshooting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/troubleshooting/">How to Troubleshoot and Fix Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/troubleshooting/troubleshooting-deployment">Troubleshooting Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/troubleshooting/rerunning-workflow-executions">Rerunning workflow executions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/troubleshooting/reindex-elasticsearch">Reindexing Elasticsearch Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/troubleshooting/troubleshooting-database-migrations">Troubleshooting Database Migrations</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/cumulus-development">Cumulus Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cumulus Development&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/adding-a-task">Contributing a Task</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/docs-how-to">Cumulus Documentation: How To&#x27;s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/development/release">Versioning and Releases</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/integrator-guide">Integrator Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrator Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/integrator-guide/about-int-guide">About Integrator Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/integrator-guide/int-common-use-cases">Integrator Common Use Cases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/integrator-guide/workflow-add-new-lambda">Workflow - Add New Lambda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/integrator-guide/workflow-ts-failed-step">Workflow - Troubleshoot Failed Step(s)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/upgrade-notes">Upgrade Notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Upgrade Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/migrate_tea_standalone">Migrate TEA deployment to standalone module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade_tf_version_0.13.6">Upgrade to TF version 0.13.6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade_tf_version_1.5.3">Upgrade to TF version 1.5.3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade-rds">Upgrade to RDS release</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/cumulus_distribution_migration">Migrate from TEA deployment to Cumulus Distribution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/update-task-file-schemas">Updates to task granule file schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/update-cma-2.0.2">Upgrade to CMA 2.0.2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade-rds-phase-3-release">Upgrade RDS Phase 3 Release</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/rds-phase-3-data-migration-guidance">Data Integrity &amp; Migration Guidance (RDS Phase 3 Upgrade)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade-rds-cluster-tf-postgres-13">Upgrade Database Cluster to PostgreSQL v13</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade-rds-cluster-tf-postgres-17">Upgrade Database Cluster to PostgreSQL v17</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/update-cumulus_id-type-indexes-CUMULUS-3449">Update Cumulus_id Type and Indexes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade_execution_table_CUMULUS_3320">Upgrade execution table to CUMULUS-3320</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/update_table_indexes_CUMULUS_3792">Update Table Indexes for CUMULUS-3792</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/serverless-v2-upgrade">Upgrading from Aurora Serverless V1 to V2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/upgrade-terraform-1.12">Upgrade to Terraform 1.12</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/archived_column_indexing">Add and Index Archived Column</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cumulus/docs/v21.0.0/upgrade-notes/update-granules-to-include-producer_granule_id">Update granules to include producer_granule_id</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/category/external-contributions">External Contributions</a><button aria-label="Toggle the collapsible sidebar category &#x27;External Contributions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/external-contributions/">External Contributions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/data-cookbooks/about-cookbooks">Data Cookbooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data Cookbooks&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v21.0.0/data-cookbooks/about-cookbooks">About Cookbooks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cumulus/docs/v21.0.0/category/cookbooks">Cookbooks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cookbooks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/cumulus/docs/v21.0.0/operator-docs/about-operator-docs">Operator Docs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operator Docs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cumulus/docs/v21.0.0/category/configuration-1">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cumulus/docs/v21.0.0/category/operations">Operations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cumulus/docs/v21.0.0/category/common-use-cases">Common Use Cases</a><button aria-label="Toggle the collapsible sidebar category &#x27;Common Use Cases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cumulus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cumulus/docs/v21.0.0/category/upgrade-notes"><span itemprop="name">Upgrade Notes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Update granules to include producer_granule_id</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v21.0.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Update granules to include producer_granule_id</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2><p>As part of the work for <a href="https://bugs.earthdata.nasa.gov/browse/CUMULUS-4058" target="_blank" rel="noopener noreferrer">CUMULUS-4058 Handle Granules with Identical producerGranuleId in Different
Collections</a>, we are adding a
producer_granule_id column to the granules table.</p><p>The following updates are included:</p><ul><li>Check for duplicate granule_id values</li><li>Add a new producer_granule_id column to the granules table</li><li>Populate the producer_granule_id column in batches with values from the granule_id column</li><li>Make the producer_granule_id column NOT NULL and create an index on it</li><li>Vacuum the granules table</li></ul><p>The updates will be automatically created as part of the bootstrap lambda function on deployment of the data-persistence module.</p><p><em>In cases where the column and index are already applied, the updates will have no effect.</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisite">Prerequisite<a href="#prerequisite" class="hash-link" aria-label="Direct link to Prerequisite" title="Direct link to Prerequisite">​</a></h2><p>Verify that there are no duplicate granule_id values in the granules table.
If any are found, identify and remove the redundant records.</p><p>Previous Cumulus releases did not support ingesting the same granule_id across different collections.
Therefore, in theory, there should be no duplicate granule_id values in the granules table. However,
the current database schema does allow duplicates by design, as it enforces uniqueness only on the
combination of granule_id and collection_cumulus_id through a composite unique index.</p><p>To identify any duplicate granule_id values, run the following query:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> granule_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> granules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> granule_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">HAVING</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> count </span><span class="token keyword" style="font-style:italic">DESC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The migration script will abort if there are duplicate granule_id values in the granules table.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="apply-the-changes-in-production-environment">Apply the Changes in Production Environment<a href="#apply-the-changes-in-production-environment" class="hash-link" aria-label="Direct link to Apply the Changes in Production Environment" title="Direct link to Apply the Changes in Production Environment">​</a></h2><p>For large databases (e.g., when the <code>granules</code> table contains more than 100,000 rows), updates must
be applied manually, as the commands can take a significant amount of time. Since <code>ALTER TABLE</code>
commands require an <strong>exclusive lock</strong> on the table, and populating the new column is time-consuming,
it is recommended to <strong>quiesce all database activity</strong> during this process. This means pausing
Ingest, Archive, and other Cumulus functions before and during the execution of these commands.</p><p>The table below, from the LP DAAC SNAPSHOT database running on Aurora Serverless v2 with
PostgreSQL 17.4, shows the table sizes before and after the migration commands, along with their
execution times. The commands were run using 32 ACUs, and table sizes were measured using the
following query:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> pg_size_pretty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pg_total_relation_size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;granules&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>Table Name</th><th>Original Table Size</th><th>New Table Size</th><th>Number of Rows</th><th>Migration Time</th></tr></thead><tbody><tr><td>granules</td><td>230 GB</td><td>241 GB</td><td>163 M</td><td>10 hours 40 minutes (1 worker)<br>3 hours 40 minutes (5 workers)<br>2 hours 30 minutes (10 workers)</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tools-used">Tools Used<a href="#tools-used" class="hash-link" aria-label="Direct link to Tools Used" title="Direct link to Tools Used">​</a></h2><p>Since the update commands can take a few hours to run based on table size and IO throughput, it is recommended that the commands are run in an EC2 instance
in the AWS environment in a tmux or screen session. This will minimize the number of network hops and potential disconnects between the database client
and the database. Additionally, this will allow operators applying the patch to check on progress periodically and not worry about credential expiration or
other issues that would result in the client being killed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-steps">Upgrade Steps<a href="#upgrade-steps" class="hash-link" aria-label="Direct link to Upgrade Steps" title="Direct link to Upgrade Steps">​</a></h2><ol><li><p>Quiesce ingest</p><p>Stop all ingest operations in Cumulus Core according to your operational procedures. You should validate
that it appears there are no active queries that appear to be inserting granules/files into the database
as a secondary method of evaluating the database system state:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">select pid, query, state, wait_event_type, wait_event from pg_stat_activity where state = &#x27;active&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If query rows are returned with a <code>query</code> value that involves the tables, make sure ingest is halted
and no other granule-update activity is running on the system.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>In rare instances if there are hung queries that are unable to resolve, it may be necessary to
manually use psql <a href="https://www.postgresql.org/docs/17/functions-admin.html#FUNCTIONS-ADMIN-SIGNAL" target="_blank" rel="noopener noreferrer">Server Signaling
Functions</a>
<code>pg_cancel_backend</code> and/or
<code>pg_terminate_backend</code> to end the queries.</p></div></div></li><li><p>Login into EC2 instance with database access.</p><p>From AWS console: Go to EC2, pick a <code>&lt;prefix&gt;-CumulusECSCluster</code> instance, click Connect, click Session Manager
and click the Connect button.</p><p>From AWS CLI: aws ssm start-session --target <code>EC2 Instance ID</code>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Remember to take a note on which instance you run the commands.</div><div class="admonitionContent_S0QG"></div></div></li><li><p>Install tmux, postgres client and python packages</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo yum install -y tmux</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo dnf install -y postgresql17</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo dnf install -y python3 python3-pip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pip3 install --user psycopg2-binary</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once installed, a <code>tmux</code> session is started with two windows. Alternatively, you can open two
concurrent SSM sessions to the same EC2 instance and start a separate tmux session from each.</p><p>The primary window is used to run the migration script, while the secondary window is used
to monitor the database. When the operator&#x27;s shift ends or monitoring is no longer needed,
the tmux session can be detached and reattached later as needed.</p></li><li><p>Run Migration Script
The database login credentials can be retrieved from the <code>&lt;prefix&gt;_db_login</code> secret.
When the migration script is running, perform step 5 to monitor the commands.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -o /home/ssm-user/20250425134823_granules_add_producer_granule_id.py https://raw.githubusercontent.com/nasa/cumulus/master/packages/db/src/migrations/20250425134823_granules_add_producer_granule_id.py</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tmux new-session -s CumulusUpgrade -n add-producer_granule_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">python3 /home/ssm-user/20250425134823_granules_add_producer_granule_id.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p><strong>BATCH SIZE</strong>: The actual number of rows updated in each batch may be less than BATCH_SIZE because
cumulus_id values may not increase by exactly 1.</p><p><strong>Number of parallel workers</strong>: This value controls how many concurrent threads process batches of
<code>producer_granule_id</code> updates. Increasing it can speed up processing but may also increase the load
on the database. Adjust based on system capacity and performance needs.</p></div></div><p>Example output from migrating the LP DAAC SNAPSHOT database:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ python3 /home/ssm-user/20250425134823_granules_add_producer_granule_id.py</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter DB host []: cumulus-dev-rds-cluster.cluster-xxx.us-east-1.rds.amazonaws.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter DB port [5432]:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter DB name []: cumulus_test_db</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter DB user []: cumulus_test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter DB password:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter BATCH SIZE for populating column [100000]:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Number of parallel workers [1]: 5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Batch Update Recovery mode? (Y/N) [N]:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:24:19.981864] Checking for duplicate granule_id values...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:40.802003] No duplicate granule_id values found.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:40.802177] Adding column producer_granule_id if not present...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.279347] Column check complete.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.279536] Disabling autovacuum on granules table...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.293261] Autovacuum disabled.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.295678] Fetching min/max cumulus_id values (Normal mode)...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.336381] Populating cumulus_id range: 3 to 560391416</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.336432] Starting parallel batch update with 5 worker(s)...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.355991] [Worker] Updating rows where cumulus_id BETWEEN 3 AND 100002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.361517] [Worker] Updating rows where cumulus_id BETWEEN 200003 AND 300002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.361676] [Worker] Updating rows where cumulus_id BETWEEN 100003 AND 200002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.361784] [Worker] Updating rows where cumulus_id BETWEEN 300003 AND 400002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:35:41.361893] [Worker] Updating rows where cumulus_id BETWEEN 400003 AND 500002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:36:12.394086] [Worker] Updated 23062 rows where cumulus_id BETWEEN 300003 AND 400002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:36:12.394207] [Worker] Updated 23028 rows where cumulus_id BETWEEN 200003 AND 300002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:36:12.410337] [Worker] Updating rows where cumulus_id BETWEEN 500003 AND 600002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:36:12.410914] [Worker] Updating rows where cumulus_id BETWEEN 600003 AND 700002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T12:36:12.413539] [Worker] Updated 22829 rows where cumulus_id BETWEEN 100003 AND 200002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:50.150774] [Worker] Updating rows where cumulus_id BETWEEN 560100003 AND 560200002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:51.161134] [Worker] Updated 2825 rows where cumulus_id BETWEEN 560100003 AND 560200002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:51.178434] [Worker] Updating rows where cumulus_id BETWEEN 560200003 AND 560300002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:53.548197] [Worker] Updated 19121 rows where cumulus_id BETWEEN 559900003 AND 560000002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:53.564171] [Worker] Updating rows where cumulus_id BETWEEN 560300003 AND 560391416</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:53.625941] [Worker] Updated 3 rows where cumulus_id BETWEEN 560300003 AND 560391416</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:54.883654] [Worker] Updated 16801 rows where cumulus_id BETWEEN 560000003 AND 560100002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:57.284970] [Worker] Updated 21143 rows where cumulus_id BETWEEN 560200003 AND 560300002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:57.933015] [Worker] Updated 60548 rows where cumulus_id BETWEEN 559600003 AND 559700002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:58.171666] [Worker] Updated 59506 rows where cumulus_id BETWEEN 559500003 AND 559600002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:58.172481] Parallel batch update complete.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:31:58.175522] Setting producer_granule_id column to NOT NULL...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:35:28.853811] Column is now NOT NULL.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:35:28.853993] Vacuuming granules table...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:47:06.325941] Vacuum complete.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:47:06.326141] Creating index on producer_granule_id...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:59:29.662899] Index created.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:59:29.663072] Re-enabling autovacuum on granules table...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:59:29.711125] Autovacuum re-enabled.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2025-08-28T15:59:29.713473] Update completed successfully.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>RECOVERY_MODE</div><div class="admonitionContent_S0QG"><p>If the migration is incomplete (e.g., the <code>producer_granule_id</code> column is partially populated),
you can run the script in <strong>recovery mode</strong> to resume the migration process. The script will skip
records that have already been migrated.</p></div></div><p>You can find the SQL commands used for the migration
<a href="https://raw.githubusercontent.com/nasa/cumulus/master/packages/db/src/migrations/20250425134823_granules_add_producer_granule_id.sql" target="_blank" rel="noopener noreferrer">here</a>
for your reference.</p></li><li><p>Monitor the Running Command</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># From tmux CumulusUpgrade session, open another window</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;Ctrl&gt;-b c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">psql -h &lt;Endpoint for writer instance&gt; -p &lt;Port for database or 5432&gt; -d &lt;cumulus database name&gt; -U &lt;database admin user&gt; -W</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select pid, query, state, wait_event_type, wait_event from pg_stat_activity where state = &#x27;active&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Verify the Updates</p><p>We can verify that the tables are updated successfully by checking the <code>\d+ table</code> results from psql.  The following are expected results.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">=&gt; \d+ granules;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Column           |           Type           | Collation | Nullable |               Default    |           Description</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---------------------------+--------------------------+-----------+----------+--------------------------+------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">producer_granule_id        | text                     |           | not null |                          | Producer Granule Id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Indexes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;granules_producer_granule_id_index&quot; btree (producer_granule_id)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make Sure Autovacuum Is Re-Enabled</p><p>The output of <code>\d+ granules</code> should <strong>NOT</strong> have output <code>Options: autovacuum_enabled=false, toast.autovacuum_enabled=false</code>.
You can also run the following query:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT relname AS table_name, reloptions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM pg_class</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WHERE relname = &#x27;granules&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> reloptions should <strong>NOT</strong> includes <code>autovacuum_enabled=false</code></p></li><li><p>Close the Session</p><p>Close the tmux session after the task is complete by <code>exit</code> or <code>&lt;Ctrl&gt;-b x</code>.</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-09T16:33:58.000Z">Sep 9, 2025</time></b> by <b>Nate Pauzenga</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cumulus/docs/v21.0.0/upgrade-notes/archived_column_indexing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Add and Index Archived Column</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cumulus/docs/v21.0.0/category/external-contributions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">External Contributions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#prerequisite" class="table-of-contents__link toc-highlight">Prerequisite</a></li><li><a href="#apply-the-changes-in-production-environment" class="table-of-contents__link toc-highlight">Apply the Changes in Production Environment</a></li><li><a href="#tools-used" class="table-of-contents__link toc-highlight">Tools Used</a></li><li><a href="#upgrade-steps" class="table-of-contents__link toc-highlight">Upgrade Steps</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/cumulus/assets/js/runtime~main.682a3672.js"></script>
<script src="/cumulus/assets/js/main.52adefda.js"></script>
</body>
</html>