<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Ingest Browse Generation · Cumulus Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;browse-generation&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#browse-generation&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Browse Generation&lt;/h1&gt;
"/><meta name="docsearch:version" content="1.12.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Ingest Browse Generation · Cumulus Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://nasa.github.io/cumulus/"/><meta property="og:description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;browse-generation&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#browse-generation&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Browse Generation&lt;/h1&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/cumulus/undefined"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/cumulus/css/main.css"/><script src="/cumulus/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/cumulus/"><h2 class="headerTitle">Cumulus Documentation</h2></a><a href="/cumulus/versions"><h3>1.12.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://nasa.github.io/cumulus-api" target="_self">API Docs</a></li><li class=""><a href="/cumulus/docs/1.12.0/cumulus-docs-readme" target="_self">Developer Docs</a></li><li class="siteNavGroupActive"><a href="/cumulus/docs/1.12.0/data-cookbooks/about-cookbooks" target="_self">Data-Cookbooks</a></li><li class=""><a href="/cumulus/docs/1.12.0/operator-docs/about-operator-docs" target="_self">Operator Docs</a></li><li class=""><a href="/cumulus/docs/1.12.0/team" target="_self">Team</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Cookbooks</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">About Cookbooks</h3><ul class=""><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/about-cookbooks">About Cookbooks</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/setup">Data Cookbooks Setup</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Cookbooks</h3><ul class=""><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/hello-world">HelloWorld Workflow</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/sns">SNS Notification in Workflows</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/sips-workflow">Science Investigator-led Processing Systems (SIPS)</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/cnm-workflow">CNM Workflow</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/error-handling">Error Handling in Workflows</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/choice-states">Choice States</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/cloudwatch-retention">Cloudwatch Retention</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/browse-generation">Ingest Browse Generation</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/1.12.0/data-cookbooks/tracking-files">Tracking Ancillary Files</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="browse-generation"></a><a href="#browse-generation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Browse Generation</h1>
<p>This entry documents how to setup a workflow that utilizes Cumulus's built-in granule file fileType configuration such that on ingest the browse data is exported to CMR.</p>
<p>We will discuss how to run a processing workflow against an inbound granule that has data but no browse generated.  The workflow will generate a browse file and add the appropriate output values to the Cumulus message so that the built-in post-to-cmr task will publish the data appropriately.</p>
<h2><a class="anchor" aria-hidden="true" id="sections"></a><a href="#sections" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sections:</h2>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#configure-cumulus">Configure Cumulus</a></li>
<li><a href="#configure-ingest">Configure Ingest</a></li>
<li><a href="#run-workflows">Run Workflows</a></li>
<li><a href="#build-processing-lambda">Build Processing Lambda</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<h3><a class="anchor" aria-hidden="true" id="cumulus"></a><a href="#cumulus" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cumulus</h3>
<p>This entry assumes you have a deployed instance of Cumulus (&gt; version 1.11.3), and a working dashboard following the instructions in the <a href="../deployment/deployment-readme">deployment documentation</a>.  This entry also assumes you have some knowledge of how to configure Collections, Providers and Rules and basic Cumulus operation.</p>
<p>Prior to working through this entry, you should be somewhat familiar with the <a href="hello-world">Hello World</a> example the <a href="../workflows/workflows-readme">Workflows</a> section of the documentation, and <a href="../workflows/lambda">building Cumulus lambdas</a>.</p>
<p>You should also review the <a href="setup">Data Cookbooks Setup</a> portion of the documentation as it contains useful information on the inter-task message schema expectations.</p>
<p>This entry will utilize the <a href="https://github.com/nasa/cumulus-dashboard">dashboard application</a>.  You will need to have a dashboard deployed as described in the <a href="../deployment/deployment-readme">Cumulus deployment documentation</a> to follow the instructions in this example.</p>
<p>If you'd prefer to <em>not</em> utilize a running dashboard to add Collections, Providers and trigger Rules, you can set the Collection/Provider and Rule via the API, however in that instance you should be very familiar with the <a href="https://nasa.github.io/cumulus-api/">Cumulus API</a> before attempting the example in this entry.</p>
<h3><a class="anchor" aria-hidden="true" id="common-metadata-repository"></a><a href="#common-metadata-repository" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Common Metadata Repository</h3>
<p>You should be familiar with the <a href="https://earthdata.nasa.gov/about/science-system-description/eosdis-components/common-metadata-repository">Common Metadata Repository</a> and already be set up as a provider with configured collections and credentials to ingest data into CMR.   You should know what the collection name and version number are.</p>
<h3><a class="anchor" aria-hidden="true" id="source-data"></a><a href="#source-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Source Data</h3>
<p>You should have data available for Cumulus to ingest in an S3 bucket that matches with CMR if you'd like to push a record to CMR UAT.</p>
<p>For the purposes of this entry, we will be using a pre-configured  MOD09GQ version 006 CMR collection.    If you'd prefer to utilize the example processing code, using mocked up data files matching the file naming convention will suffice, so long as you also have a matching collection setup in CMR.</p>
<p>If you'd prefer to ingest another data type, you will need to generate a processing lambda (see <a href="#build-processing-lamvda">Build Processing Lambda</a> below).</p>
<hr>
<h2><a class="anchor" aria-hidden="true" id="configure-cumulus"></a><a href="#configure-cumulus" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configure Cumulus</h2>
<h3><a class="anchor" aria-hidden="true" id="cmr"></a><a href="#cmr" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CMR</h3>
<p>The following configuration settings will allow the workflow in this example to authenticate with CMR.</p>
<p>Ensure your CMR username/password is included in your <code>app/.env</code> file, as noted in the <a href="../deployment/deployment-readme">deployment documentation</a>:</p>
<pre><code class="hljs"><span class="hljs-attr">CMR_USERNAME</span>=cmruser
<span class="hljs-attr">CMR_PASSWORD</span>=cmrpassword
</code></pre>
<p>These values will be imported via kes in your configuration file.   You should ensure your <code>app/config.yml</code> contains the following lines:
cmr:</p>
<pre><code class="hljs">  <span class="hljs-attribute">username</span>: <span class="hljs-string">'{{CMR_USERNAME}}'</span>
  <span class="hljs-attribute">provider</span>: CUMULUS
  <span class="hljs-attribute">clientId</span>: <span class="hljs-string">'cumulus-core-{{stackName}}'</span>
  <span class="hljs-attribute">password</span>: <span class="hljs-string">'{{CMR_PASSWORD}}'</span>
</code></pre>
<p>These configuration keys will be used in the CmrStep/PostToCmr Lambda function below.</p>
<h3><a class="anchor" aria-hidden="true" id="workflows"></a><a href="#workflows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Workflows</h3>
<h4><a class="anchor" aria-hidden="true" id="summary"></a><a href="#summary" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h4>
<p>For this example, you are going to be adding two workflows to your Cumulus deployment configuration.</p>
<ul>
<li><p>DiscoverGranulesBrowseExample</p>
<p>This workflow will run the <code>DiscoverGranules</code> task, targeting the S3 bucket/folder mentioned in the prerequisites.    The output of that task will be passed into QueueGranules, which will trigger the second workflow for each granule to be ingested.   The example presented here will be a single granule with a .hdf data file and a .met metadata file only, however your setup may result in more granules, or different files.</p></li>
</ul>
<ul>
<li><p>CookbookBrowseExample</p>
<p>This workflow will be triggered for each granule in the previous workflow.    It will utilize the SyncGranule task, which brings the files into a staging location in the Cumulus buckets.</p>
<p>The output from this task will be passed into the <code>ProcessingStep</code> step , which in this example will utilize the <code>FakeProcessingLambda</code> task we provide for testing/as an example in Core, however to use your own data you will need to write a lambda that generates the appropriate CMR metadata file and accepts and returns appropriate task inputs and outputs.</p>
<p>From that task  we will utilize a core task <code>FilesToGranules</code> that will transform the processing output event.input list/config.InputGranules into an array of Cumulus <a href="https://github.com/nasa/cumulus/blob/master/packages/api/models/schemas.js">granules</a> objects.</p>
<p>Using the generated granules list, we will utilize the core task <code>MoveGranules</code> to move the granules to the target buckets as defined in the collection configuration.  That task will transfer the files to their final storage location and update the CMR metadata files and the granules list as output.</p>
<p>That output will be used in the <code>PostToCmr</code> task combined with the previously generated CMR file to export the granule metadata to CMR.</p></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="workflow-configuration"></a><a href="#workflow-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Workflow Configuration</h4>
<p>Add the following to a new file <code>browseExample.yml</code> in your deployment's main directory (the same location your app directory, lambdas.yml, etc are), copy the example file <a href="https://github.com/nasa/cumulus/blob/master/example/workflows/browseExample.yml">from github</a>.  The file should contain the two example workflows.</p>
<p>A few things to note about tasks in the workflow being added:</p>
<ul>
<li>The CMR step in CookbookBrowseExample:</li>
</ul>
<pre><code class="hljs"><span class="hljs-attr"> CmrStep:</span>
<span class="hljs-attr">      CumulusConfig:</span>
<span class="hljs-attr">        bucket:</span> <span class="hljs-string">'{$.meta.buckets.internal.name}'</span>
<span class="hljs-attr">        stack:</span> <span class="hljs-string">'{$.meta.stack}'</span>
<span class="hljs-attr">        cmr:</span> <span class="hljs-string">'{$.meta.cmr}'</span>
<span class="hljs-attr">        process:</span> <span class="hljs-string">'{$.cumulus_meta.process}'</span>
<span class="hljs-attr">        input_granules:</span> <span class="hljs-string">'{$.meta.input_granules}'</span>
<span class="hljs-attr">        granuleIdExtraction:</span> <span class="hljs-string">'{$.meta.collection.granuleIdExtraction}'</span>
<span class="hljs-attr">      Type:</span> <span class="hljs-string">Task</span>
<span class="hljs-attr">      Resource:</span> <span class="hljs-string">${PostToCmrLambdaFunction.Arn}</span>
<span class="hljs-attr">      Catch:</span>
<span class="hljs-attr">        - ErrorEquals:</span>
<span class="hljs-bullet">          -</span> <span class="hljs-string">States.ALL</span>
<span class="hljs-attr">          ResultPath:</span> <span class="hljs-string">'$.exception'</span>
<span class="hljs-attr">          Next:</span> <span class="hljs-string">StopStatus</span>
<span class="hljs-attr">      Next:</span> <span class="hljs-string">StopStatus</span>
</code></pre>
<p>Note that in the task, the event.config.cmr will contain the values you configured in the <code>cmr</code> configuration section above.</p>
<ul>
<li>The Processing step in CookbookBrowseExample:</li>
</ul>
<pre><code class="hljs"><span class="hljs-attr">    ProcessingStep:</span>
<span class="hljs-attr">      CumulusConfig:</span>
<span class="hljs-attr">        bucket:</span> <span class="hljs-string">'{$.meta.buckets.internal.name}'</span>
<span class="hljs-attr">        collection:</span> <span class="hljs-string">'{$.meta.collection}'</span>
<span class="hljs-attr">        cmrMetadataFormat:</span> <span class="hljs-string">'{$.meta.cmrMetadataFormat}'</span>
<span class="hljs-attr">        additionalUrls:</span> <span class="hljs-string">'{$.meta.additionalUrls}'</span>
<span class="hljs-attr">        generateFakeBrowse:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">      Type:</span> <span class="hljs-string">Task</span>
<span class="hljs-attr">      Resource:</span> <span class="hljs-string">${FakeProcessingLambdaFunction.Arn}</span>
<span class="hljs-attr">      Catch:</span>
<span class="hljs-attr">        - ErrorEquals:</span>
<span class="hljs-bullet">          -</span> <span class="hljs-string">States.ALL</span>
<span class="hljs-attr">          ResultPath:</span> <span class="hljs-string">'$.exception'</span>
<span class="hljs-attr">          Next:</span> <span class="hljs-string">StopStatus</span>
<span class="hljs-attr">      Retry:</span>
<span class="hljs-attr">        - ErrorEquals:</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">States.ALL</span>
<span class="hljs-attr">          IntervalSeconds:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">          MaxAttempts:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">      Next:</span> <span class="hljs-string">FilesToGranulesStep</span>
</code></pre>
<p><strong>Please note</strong>: <code>FakeProcessing</code> is the core provided browse/cmr generation we're using for the example in this entry.</p>
<p>If you're not ingesting mock data matching the example, or would like to use modify the example to ingest your own data please see the <a href="#build-lambda">build-lambda</a> section below.    You will need to configure a different lambda entry for your lambda and utilize it in place of the <code>Resource</code> defined in the example workflow.</p>
<h4><a class="anchor" aria-hidden="true" id="cumulus-configuration"></a><a href="#cumulus-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cumulus Configuration</h4>
<p>In an editor, open app/config.yml and modify your stepFunctions key to contain the file you just created:</p>
<pre><code class="hljs">stepFunctions: !!files [
  {some <span class="hljs-built_in">list</span> <span class="hljs-keyword">of</span> workflows},
  <span class="hljs-symbol">'browseExample</span>.yml'
]
</code></pre>
<p>This will cause kes to export the workflows in the new file along with the other workflows configured for your deployment.</p>
<h4><a class="anchor" aria-hidden="true" id="lambdas"></a><a href="#lambdas" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lambdas</h4>
<p>Ensure the following lambdas are in your deployment's lambdas.yml (reference the <a href="https://github.com/nasa/cumulus/blob/master/example/lambdas.yml">example lambdas.yml</a>):</p>
<pre><code class="hljs"><span class="hljs-attribute">DiscoverGranulesNoVpc</span>:
  <span class="hljs-attribute">handler</span>: index.handler
  <span class="hljs-attribute">timeout</span>: <span class="hljs-number">300</span>
  <span class="hljs-attribute">memory</span>: <span class="hljs-number">512</span>
  <span class="hljs-attribute">source</span>: node_modules/<span class="hljs-variable">@cumulus</span>/discover-granules/dist/
  <span class="hljs-attribute">useMessageAdapter</span>: true
<span class="hljs-attribute">QueueGranules</span>:
  <span class="hljs-attribute">handler</span>: index.handler
  <span class="hljs-attribute">timeout</span>: <span class="hljs-number">300</span>
  <span class="hljs-attribute">source</span>: node_modules/<span class="hljs-variable">@cumulus</span>/queue-granules/dist/
  <span class="hljs-attribute">useMessageAdapter</span>: true
<span class="hljs-attribute">SyncGranuleNoVpc</span>:
  <span class="hljs-attribute">handler</span>: index.handler
  <span class="hljs-attribute">timeout</span>: <span class="hljs-number">300</span>
  <span class="hljs-attribute">logToElasticSearch</span>: true
  <span class="hljs-attribute">source</span>: node_modules/<span class="hljs-variable">@cumulus</span>/sync-granule/dist/
  <span class="hljs-attribute">useMessageAdapter</span>: true
<span class="hljs-attribute">FilesToGranules</span>:
  <span class="hljs-attribute">handler</span>: index.handler
  <span class="hljs-attribute">source</span>: node_modules/<span class="hljs-variable">@cumulus</span>/files-to-granules/dist/
<span class="hljs-attribute">FakeProcessing</span>:
  <span class="hljs-attribute">handler</span>: index.handler
  <span class="hljs-attribute">source</span>: node_modules/<span class="hljs-variable">@cumulus</span>/test-processing/dist/
  <span class="hljs-attribute">useMessageAdapter</span>: true
<span class="hljs-attribute">MoveGranules</span>:
  <span class="hljs-attribute">handler</span>: index.handler
  <span class="hljs-attribute">timeout</span>: <span class="hljs-number">300</span>
  <span class="hljs-attribute">source</span>: node_modules/<span class="hljs-variable">@cumulus</span>/move-granules/dist/
<span class="hljs-attribute">PostToCmr</span>:
  <span class="hljs-attribute">handler</span>: index.handler
  <span class="hljs-attribute">timeout</span>: <span class="hljs-number">300</span>
  <span class="hljs-attribute">memory</span>: <span class="hljs-number">256</span>
  <span class="hljs-attribute">logToElasticSearch</span>: true
  <span class="hljs-attribute">source</span>: node_modules/<span class="hljs-variable">@cumulus</span>/post-to-cmr/dist/
  <span class="hljs-attribute">useMessageAdapter</span>: true
  <span class="hljs-attribute">envs</span>:
    <span class="hljs-attribute">system_bucket</span>: <span class="hljs-string">'{{system_bucket}}'</span>
</code></pre>
<p><strong>Please note</strong>: <code>FakeProcessing</code> is the core provided browse/cmr generation we're using for the example.</p>
<p>If you're not ingesting mock data matching the example, or would like to use this entry to ingest your own data please see the <a href="#build-lambda">build-lambda</a> section below.    You will need to configure a different lambda entry for your lambda and utilize it in place of the <code>Resource</code> defined in the example workflow.</p>
<h4><a class="anchor" aria-hidden="true" id="redeploy"></a><a href="#redeploy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Redeploy</h4>
<p>Once you've configured your CMR credentials, updated your workflow configuration, and updated your lambda configuration you should be able to redeploy your cumulus instance:</p>
<p><code>./node_modules/.bin/kes cf deploy --kes-folder app --region &lt;region&gt; --template node_modules/@cumulus/deployment/app --deployment &lt;deployment&gt;</code></p>
<p>You should expect to see a successful deployment message similar to:</p>
<pre><code class="hljs">Template saved <span class="hljs-built_in">to</span> app/cloudformation.yml
Uploaded: s3://&lt;bucket <span class="hljs-keyword">and</span> key&gt;/cloudformation.yml
Waiting <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> CF operation <span class="hljs-built_in">to</span> complete
CF operation is <span class="hljs-keyword">in</span> state <span class="hljs-keyword">of</span> UPDATE_COMPLETE

Here are <span class="hljs-keyword">the</span> important URLs <span class="hljs-keyword">for</span> this deployment:

Distribution:  <span class="hljs-keyword">https</span>://example.com/
Add this url <span class="hljs-built_in">to</span> URS:  <span class="hljs-keyword">https</span>://example.com/redirect

Api:  XXXXXXX
Add this url <span class="hljs-built_in">to</span> URS:  XXXXXXXXXX
Uploading Cumulus Message Templates <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> Workflow ...
......
restarting ECS task XXXXXXXXXX
ECS task aXXXXXXXX restarted
api endpoints <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> id XXXXXXXXXXX redeployed.
Redeploying XXXXXXXXXX was throttled. Another attempt will be made <span class="hljs-keyword">in</span> <span class="hljs-number">20</span> <span class="hljs-built_in">seconds</span>
distribution endpoints <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> id XXXXXXXXXX redeployed.
</code></pre>
<p>Wait for the above to complete. It's particularly important that the new workflow message template is uploaded for the workflow to complete.</p>
<hr>
<h2><a class="anchor" aria-hidden="true" id="configure-ingest"></a><a href="#configure-ingest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configure Ingest</h2>
<p>Now that the Cumulus stacks for your deployment have been updated with the new workflows and code, we will use the Cumulus dashboard to configure an ingest collection, provider and rule so that we can trigger the configured workflow.</p>
<h3><a class="anchor" aria-hidden="true" id="add-collection"></a><a href="#add-collection" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add Collection</h3>
<p>Navigate to the 'Collection' tab on the interface and add a collection.  Note that you need to set the &quot;provider_path&quot; to the path on your bucket (e.g. &quot;/data&quot;) that you've staged your mock/test data.</p>
<pre><code class="hljs">{
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MOD09GQ"</span>,
    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"006"</span>,
    <span class="hljs-attr">"dataType"</span>: <span class="hljs-string">"MOD09GQ"</span>,
    <span class="hljs-attr">"process"</span>: <span class="hljs-string">"modis"</span>,
    <span class="hljs-attr">"provider_path"</span>: <span class="hljs-string">"{{path_to_data}}"</span>,
    <span class="hljs-attr">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{substring(file.name, 0, 3)}"</span>,
    <span class="hljs-attr">"duplicateHandling"</span>: <span class="hljs-string">"replace"</span>,
    <span class="hljs-attr">"granuleId"</span>: <span class="hljs-string">"^MOD09GQ\\.A[\\d]{7}\\.[\\S]{6}\\.006\\.[\\d]{13}$"</span>,
    <span class="hljs-attr">"granuleIdExtraction"</span>: <span class="hljs-string">"(MOD09GQ\\..*)(\\.hdf|\\.cmr|_ndvi\\.jpg|\\.jpg)"</span>,
    <span class="hljs-attr">"sampleFileName"</span>: <span class="hljs-string">"MOD09GQ.A2017025.h21v00.006.2017034065104.hdf"</span>,
    <span class="hljs-attr">"files"</span>: [
        {
            <span class="hljs-attr">"bucket"</span>: <span class="hljs-string">"protected"</span>,
            <span class="hljs-attr">"regex"</span>: <span class="hljs-string">"^MOD09GQ\\.A[\\d]{7}\\.[\\S]{6}\\.006\\.[\\d]{13}\\.hdf$"</span>,
            <span class="hljs-attr">"sampleFileName"</span>: <span class="hljs-string">"MOD09GQ.A2017025.h21v00.006.2017034065104.hdf"</span>,
            <span class="hljs-attr">"fileType"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-attr">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{extractYear(cmrMetadata.Granule.Temporal.RangeDateTime.BeginningDateTime)}/{substring(file.name, 0, 3)}"</span>
        },
        {
            <span class="hljs-attr">"bucket"</span>: <span class="hljs-string">"private"</span>,
            <span class="hljs-attr">"regex"</span>: <span class="hljs-string">"^MOD09GQ\\.A[\\d]{7}\\.[\\S]{6}\\.006\\.[\\d]{13}\\.hdf\\.met$"</span>,
            <span class="hljs-attr">"sampleFileName"</span>: <span class="hljs-string">"MOD09GQ.A2017025.h21v00.006.2017034065104.hdf.met"</span>,
            <span class="hljs-attr">"fileType"</span>: <span class="hljs-string">"metadata"</span>
        },
        {
            <span class="hljs-attr">"bucket"</span>: <span class="hljs-string">"protected-2"</span>,
            <span class="hljs-attr">"regex"</span>: <span class="hljs-string">"^MOD09GQ\\.A[\\d]{7}\\.[\\S]{6}\\.006\\.[\\d]{13}\\.cmr\\.xml$"</span>,
            <span class="hljs-attr">"sampleFileName"</span>: <span class="hljs-string">"MOD09GQ.A2017025.h21v00.006.2017034065104.cmr.xml"</span>
        },
        {
            <span class="hljs-attr">"bucket"</span>: <span class="hljs-string">"protected"</span>,
            <span class="hljs-attr">"regex"</span>: <span class="hljs-string">"^MOD09GQ\\.A[\\d]{7}\\.[\\S]{6}\\.006\\.[\\d]{13}\\.jpg$"</span>,
            <span class="hljs-attr">"sampleFileName"</span>: <span class="hljs-string">"MOD09GQ.A2017025.h21v00.006.2017034065104.jpg"</span>
        }
    ],
}
</code></pre>
<p><strong>Please note</strong>: Even though our initial discover granules ingest brings in only the .hdf and .met files we've staged, we still configure the other possible file types for this collection's granules.</p>
<h3><a class="anchor" aria-hidden="true" id="add-provider"></a><a href="#add-provider" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add Provider</h3>
<p>Next navigate to the Provider tab and create a provider with the following values, using whatever name you wish, and the bucket the data was staged to as the host:</p>
<pre><code class="hljs"><span class="hljs-symbol">Name:</span>
<span class="hljs-symbol">Protocol:</span> S3
<span class="hljs-symbol">Host:</span> {{data_source_bucket}}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="add-rule"></a><a href="#add-rule" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add Rule</h3>
<p>Once you have your provider and rule added, go to the Rules tab, and add a rule with the following values (using whatever name you wish, populating the workflow and provider keys with the previously entered values:</p>
<pre><code class="hljs">{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"TestBrowseGeneration"</span>,
    <span class="hljs-string">"workflow"</span>: <span class="hljs-string">"DiscoverGranulesBrowseExample"</span>,
    <span class="hljs-string">"provider"</span>: {{provider_from_previous_step}},
    <span class="hljs-string">"collection"</span>: {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ"</span>,
        <span class="hljs-string">"version"</span>: <span class="hljs-string">"006"</span>
    },
    <span class="hljs-string">"meta"</span>: {},
    <span class="hljs-string">"rule"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"onetime"</span>
    },
    <span class="hljs-string">"state"</span>: <span class="hljs-string">"ENABLED"</span>,
    <span class="hljs-string">"updatedAt"</span>: <span class="hljs-number">1553053438767</span>
}
</code></pre>
<hr>
<h2><a class="anchor" aria-hidden="true" id="run-workflows"></a><a href="#run-workflows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run Workflows</h2>
<p>Once you've configured the Collection and Provider and added a onetime rule, you're ready to trigger your rule, and watch the ingest workflows process.</p>
<p>Go to the Rules tab, click the rule you just created:</p>
<p><img src="../../assets/browse_processing_1.png" alt="Image Missing"></p>
<p>Then click the gear in the upper right corner and click &quot;ReRun&quot;:</p>
<p><img src="../../assets/browse_processing_2.png" alt="Image Missing"></p>
<p>Tab over to executions and you should see the <code>DiscoverGranulesBrowseExample</code> workflow fire, succeed and then moments later the <code>CookbookBrowseExample</code>.</p>
<p><img src="../../assets/browse_processing_3.png" alt="Image Missing"></p>
<h3><a class="anchor" aria-hidden="true" id="results"></a><a href="#results" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Results</h3>
<p>You can verify your data has ingested by clicking the successful workflow entry:</p>
<p><img src="../../assets/browse_processing_4.png" alt="Image Missing"></p>
<p>Select &quot;Show Output&quot; on the next page</p>
<p><img src="../../assets/browse_processing_5.png" alt="Image Missing"></p>
<p>and you should see in the payload from the workflow something similar to:</p>
<pre><code class="hljs"><span class="hljs-string">"payload"</span>: {
    <span class="hljs-string">"process"</span>: <span class="hljs-string">"modis"</span>,
    <span class="hljs-string">"granules"</span>: [
      {
        <span class="hljs-string">"files"</span>: [
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.hdf"</span>,
            <span class="hljs-string">"filepath"</span>: <span class="hljs-string">"MOD09GQ___006/2017/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-protected"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-protected/MOD09GQ___006/2017/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027415000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{extractYear(cmrMetadata.Granule.Temporal.RangeDateTime.BeginningDateTime)}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"duplicate_found"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">1908635</span>
          },
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.hdf.met"</span>,
            <span class="hljs-string">"filepath"</span>: <span class="hljs-string">"MOD09GQ___006/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf.met"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"metadata"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-private"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-private/MOD09GQ___006/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf.met"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027412000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"duplicate_found"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">21708</span>
          },
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.jpg"</span>,
            <span class="hljs-string">"filepath"</span>: <span class="hljs-string">"MOD09GQ___006/2017/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.jpg"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"browse"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-protected"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-protected/MOD09GQ___006/2017/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.jpg"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027415000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{extractYear(cmrMetadata.Granule.Temporal.RangeDateTime.BeginningDateTime)}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"duplicate_found"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">1908635</span>
          },
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.cmr.xml"</span>,
            <span class="hljs-string">"filepath"</span>: <span class="hljs-string">"MOD09GQ___006/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.cmr.xml"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"metadata"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-protected-2"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-protected-2/MOD09GQ___006/MOD/MOD09GQ.A2016358.h13v04.006.2016360104606.cmr.xml"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{substring(file.name, 0, 3)}"</span>
          }
        ],
        <span class="hljs-string">"cmrLink"</span>: <span class="hljs-string">"https://cmr.uat.earthdata.nasa.gov/search/granules.json?concept_id=G1222231611-CUMULUS"</span>,
        <span class="hljs-string">"cmrConceptId"</span>: <span class="hljs-string">"G1222231611-CUMULUS"</span>,
        <span class="hljs-string">"granuleId"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606"</span>,
        <span class="hljs-string">"cmrMetadataFormat"</span>: <span class="hljs-string">"echo10"</span>,
        <span class="hljs-string">"dataType"</span>: <span class="hljs-string">"MOD09GQ"</span>,
        <span class="hljs-string">"version"</span>: <span class="hljs-string">"006"</span>,
        <span class="hljs-string">"published"</span>: <span class="hljs-literal">true</span>
      }
    ]
</code></pre>
<p>You can verify the granules exist within your cumulus instance (search using the Granules interface, check the S3 buckets, etc) and validate that the above CMR entry</p>
<hr>
<h2><a class="anchor" aria-hidden="true" id="build-processing-lambda"></a><a href="#build-processing-lambda" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build Processing Lambda</h2>
<p>This section discusses the construction of a custom processing lambda to replace the contrived example from this entry for a real dataset processing task.</p>
<p>To ingest your own data using this example, you will need to construct your own lambda to replace the source in ProcessingStep that will generate browse imagery and provide or update a CMR metadata export file.</p>
<p>The discussion below outlines requirements for this lambda.</p>
<h3><a class="anchor" aria-hidden="true" id="inputs"></a><a href="#inputs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inputs</h3>
<p>The incoming message to the task defined in the  <code>ProcessingStep</code> as configured will have the following configuration values (accessible inside event.config courtesy of the message adapter):</p>
<h4><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h4>
<ul>
<li><p>event.config.bucket -- the bucket configured in config.yml as your 'internal' bucket.</p></li>
<li><p>event.config.collection -- The full collection object we will configure in the (Configure Ingest)[#configure-ingest] section.   You can view the expected collection schema in the docs (here)[/data-cookbooks/setup] or in the source code (on github)[<a href="https://github.com/nasa/cumulus/blob/master/packages/api/models/schemas.js]">https://github.com/nasa/cumulus/blob/master/packages/api/models/schemas.js]</a>  You need this as available input <em>and</em> output so you can update as needed.</p></li>
</ul>
<p><code>event.config.additionalUrls</code>, <code>generateFakeBrowse</code>  and <code>event.config.cmrMetadataFormat</code> from the example can be ignored as they're configuration flags for the provided example script.</p>
<h4><a class="anchor" aria-hidden="true" id="payload"></a><a href="#payload" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Payload</h4>
<p>The 'payload' from the previous task is accessible via event.input.    The expected payload output schema from SyncGranules can be viewed <a href="https://github.com/nasa/cumulus/blob/master/tasks/move-granules/schemas/output.json">here</a>.</p>
<p>In our example, the payload would look like the following.  <strong>Note</strong>: The fileTypes are set per-file based on what we configured in our collection, and were initially added as part of the <code>DiscoverGranules</code> step in the <code>DiscoverGranulesBrowseExample</code> workflow.</p>
<pre><code class="hljs"> <span class="hljs-string">"payload"</span>: {
    <span class="hljs-string">"process"</span>: <span class="hljs-string">"modis"</span>,
    <span class="hljs-string">"granules"</span>: [
      {
        <span class="hljs-string">"granuleId"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606"</span>,
        <span class="hljs-string">"dataType"</span>: <span class="hljs-string">"MOD09GQ"</span>,
        <span class="hljs-string">"version"</span>: <span class="hljs-string">"006"</span>,
        <span class="hljs-string">"files"</span>: [
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.hdf"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-internal"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf"</span>,
            <span class="hljs-string">"fileStagingDir"</span>: <span class="hljs-string">"file-staging/jk2/MOD09GQ___006"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027415000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{extractYear(cmrMetadata.Granule.Temporal.RangeDateTime.BeginningDateTime)}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">1908635</span>
          },
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.hdf.met"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"metadata"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-internal"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf.met"</span>,
            <span class="hljs-string">"fileStagingDir"</span>: <span class="hljs-string">"file-staging/jk2/MOD09GQ___006"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027412000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">21708</span>
          }
        ]
      }
    ]
  }
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="generating-browse-imagery"></a><a href="#generating-browse-imagery" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating Browse Imagery</h3>
<p>The provided example script used in the example goes through all granules and adds a 'fake' .jpg browse file to the same staging location as the data staged by prior ingest tasksf.</p>
<p>The processing lambda you construct will need to do the following:</p>
<ul>
<li>Create a browse image file based on the input data, and stage it to a location accessible to both this task and the <code>FilesToGranules</code> and <code>MoveGranules</code> tasks in a S3 bucket.</li>
<li>Add the browse file to the input granule files, making sure to set the granule fileType to <code>browse</code>.</li>
<li>Update meta.input_granules with the updated granules list, as well as provide the files to be integrated by <code>FilesToGranules</code> as output from the task.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="generating-updating-cmr-metadata"></a><a href="#generating-updating-cmr-metadata" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating/updating CMR metadata</h3>
<p>If you do not already have a CMR file in the granules list, you will need to generate one for valid export.   This example's processing script generates and adds it to the <code>FilesToGranules</code> file list via the payload  but it can be present in the InputGranules from the DiscoverGranules task as well if you'd prefer to pre-generate it.</p>
<p>Both downstream tasks <code>MoveGranules</code> and <code>PostToCmr</code> expect a valid CMR file to be available if you want to export to CMR.</p>
<h3><a class="anchor" aria-hidden="true" id="expected-outputs-for-processing-task-tasks"></a><a href="#expected-outputs-for-processing-task-tasks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Expected Outputs for processing task/tasks</h3>
<p>In the above example, the critical portion of the output to <code>FilesToGranules</code> is the payload and meta.input_granules.</p>
<p>In the example provided, the processing task is setup to return an object with the keys &quot;files&quot; and &quot;granules&quot;.   In the cumulus_message configuration, the outputs are mapped in the configuration to the payload, granules to meta.input_granules:</p>
<pre><code class="hljs">            - <span class="hljs-built_in">source</span>: <span class="hljs-string">'{$.granules}'</span>
              destination: <span class="hljs-string">'{$.meta.input_granules}'</span>
            - <span class="hljs-built_in">source</span>: <span class="hljs-string">'{$.files}'</span>
              destination: <span class="hljs-string">'{$.payload}'</span>
</code></pre>
<p>Their expected values from the example above may be useful in constructing a processing task:</p>
<h4><a class="anchor" aria-hidden="true" id="payload-1"></a><a href="#payload-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>payload</h4>
<p>The payload includes a full list of files to be 'moved' into the cumulus archive.   The <code>FilesToGranules</code> task will take this list, merge it with the information from <code>InputGranules</code>, then pass that list to the <code>MoveGranules</code> task.  The <code>MoveGranules</code> task will then move the files to their targets and update the CMR metadata file if it exists with the updated granule locations.</p>
<p>In the provided example, a payload being passed to the  <code>FilesToGranules</code> task should be expected to look like:</p>
<pre><code class="hljs">  "payload": [
    "s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.<span class="hljs-keyword">A</span><span class="hljs-number">2016358</span>.h<span class="hljs-number">13v04.006</span>.<span class="hljs-number">2016360104606</span>.hdf",
    "s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.<span class="hljs-keyword">A</span><span class="hljs-number">2016358</span>.h<span class="hljs-number">13v04.006</span>.<span class="hljs-number">2016360104606</span>.hdf.met",
    "s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.<span class="hljs-keyword">A</span><span class="hljs-number">2016358</span>.h<span class="hljs-number">13v04.006</span>.<span class="hljs-number">2016360104606</span>.jpg",
    "s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.<span class="hljs-keyword">A</span><span class="hljs-number">2016358</span>.h<span class="hljs-number">13v04.006</span>.<span class="hljs-number">2016360104606</span>.cmr.xml"
  ]
</code></pre>
<p>This list is the list of granules <code>FilesToGranules</code> will act upon to add/merge with the input_granules object.</p>
<p>The pathing is generated from sync-granules, but in principle the files can be staged wherever you like so long as the processing/<code>MoveGranules</code> task's roles have access and the filename matches the collection configuration.</p>
<h4><a class="anchor" aria-hidden="true" id="input_granules"></a><a href="#input_granules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>input_granules</h4>
<p>The <code>FilesToGranules</code> task utilizes the incoming payload to chose which files to move, but pulls all other metadata from meta.input_granules.  As such, the output payload in the example would look like:</p>
<pre><code class="hljs"><span class="hljs-string">"input_granules"</span>: [
      {
        <span class="hljs-string">"granuleId"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606"</span>,
        <span class="hljs-string">"dataType"</span>: <span class="hljs-string">"MOD09GQ"</span>,
        <span class="hljs-string">"version"</span>: <span class="hljs-string">"006"</span>,
        <span class="hljs-string">"files"</span>: [
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.hdf"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-internal"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf"</span>,
            <span class="hljs-string">"fileStagingDir"</span>: <span class="hljs-string">"file-staging/jk2/MOD09GQ___006"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027415000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{extractYear(cmrMetadata.Granule.Temporal.RangeDateTime.BeginningDateTime)}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"duplicate_found"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">1908635</span>
          },
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.hdf.met"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"metadata"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-internal"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.A2016358.h13v04.006.2016360104606.hdf.met"</span>,
            <span class="hljs-string">"fileStagingDir"</span>: <span class="hljs-string">"file-staging/jk2/MOD09GQ___006"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027412000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"duplicate_found"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">21708</span>
          },
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"MOD09GQ.A2016358.h13v04.006.2016360104606.jpg"</span>,
            <span class="hljs-string">"fileType"</span>: <span class="hljs-string">"browse"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"cumulus-test-sandbox-internal"</span>,
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"s3://cumulus-test-sandbox-internal/file-staging/jk2/MOD09GQ___006/MOD09GQ.A2016358.h13v04.006.2016360104606.jpg"</span>,
            <span class="hljs-string">"fileStagingDir"</span>: <span class="hljs-string">"file-staging/jk2/MOD09GQ___006"</span>,
            <span class="hljs-string">"time"</span>: <span class="hljs-number">1553027415000</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"data"</span>,
            <span class="hljs-string">"url_path"</span>: <span class="hljs-string">"{cmrMetadata.Granule.Collection.ShortName}___{cmrMetadata.Granule.Collection.VersionId}/{extractYear(cmrMetadata.Granule.Temporal.RangeDateTime.BeginningDateTime)}/{substring(file.name, 0, 3)}"</span>,
            <span class="hljs-string">"duplicate_found"</span>: <span class="hljs-literal">true</span>,
          }
        ]
      }
    ],
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/cumulus/docs/1.12.0/data-cookbooks/cloudwatch-retention"><span class="arrow-prev">← </span><span>Cloudwatch Retention</span></a><a class="docs-next button" href="/cumulus/docs/1.12.0/data-cookbooks/tracking-files"><span>Tracking Ancillary Files</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#sections">Sections:</a></li><li><a href="#prerequisites">Prerequisites</a><ul class="toc-headings"><li><a href="#cumulus">Cumulus</a></li><li><a href="#common-metadata-repository">Common Metadata Repository</a></li><li><a href="#source-data">Source Data</a></li></ul></li><li><a href="#configure-cumulus">Configure Cumulus</a><ul class="toc-headings"><li><a href="#cmr">CMR</a></li><li><a href="#workflows">Workflows</a></li></ul></li><li><a href="#configure-ingest">Configure Ingest</a><ul class="toc-headings"><li><a href="#add-collection">Add Collection</a></li><li><a href="#add-provider">Add Provider</a></li><li><a href="#add-rule">Add Rule</a></li></ul></li><li><a href="#run-workflows">Run Workflows</a><ul class="toc-headings"><li><a href="#results">Results</a></li></ul></li><li><a href="#build-processing-lambda">Build Processing Lambda</a><ul class="toc-headings"><li><a href="#inputs">Inputs</a></li><li><a href="#generating-browse-imagery">Generating Browse Imagery</a></li><li><a href="#generating-updating-cmr-metadata">Generating/updating CMR metadata</a></li><li><a href="#expected-outputs-for-processing-task-tasks">Expected Outputs for processing task/tasks</a></li></ul></li></ul></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f7e0be879553661f9043322d119069c8',
                indexName: 'nasa_cumulus',
                inputSelector: '#search_input_react'
              });
            </script></body></html>