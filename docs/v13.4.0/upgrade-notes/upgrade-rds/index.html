<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Upgrade to RDS release · Cumulus Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Background"/><meta name="docsearch:version" content="v13.4.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Upgrade to RDS release · Cumulus Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://nasa.github.io/cumulus/"/><meta property="og:description" content="## Background"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/cumulus/undefined"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"backgroundColor":"#2276AC"}
          )
        });
        </script><script src="/cumulus/js/scrollSpy.js"></script><link rel="stylesheet" href="/cumulus/css/main.css"/><script src="/cumulus/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/cumulus/"><h2 class="headerTitle">Cumulus Documentation</h2></a><a href="/cumulus/versions"><h3>v13.4.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://nasa.github.io/cumulus-api" target="_self">API Docs</a></li><li class=""><a href="https://nasa.github.io/cumulus-distribution-api" target="_self">Distribution API Docs</a></li><li class="siteNavGroupActive"><a href="/cumulus/docs/v13.4.0/cumulus-docs-readme" target="_self">Developer Docs</a></li><li class=""><a href="/cumulus/docs/v13.4.0/data-cookbooks/about-cookbooks" target="_self">Data-Cookbooks</a></li><li class=""><a href="/cumulus/docs/v13.4.0/operator-docs/about-operator-docs" target="_self">Operator Docs</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Upgrade Notes</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/cumulus-docs-readme">Introduction</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/faqs">Frequently Asked Questions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">About Cumulus<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/architecture">Architecture</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/interfaces">Interfaces</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/team">Cumulus Team</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overviews<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/workflows-readme">Workflows</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/protocol">Workflow Protocol</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/input_output">Workflow Inputs &amp; Outputs</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/cumulus-task-message-flow">Cumulus Tasks: Message Flow</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/workflow-triggers">Workflow Triggers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Deployment<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/deployment-readme">How to Deploy Cumulus</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/create_bucket">Creating an S3 Bucket</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/terraform-best-practices">Terraform Best Practices</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/choosing_configuring_rds">Choosing and configuration your RDS database</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/postgres_database_deployment">PostgreSQL Database Deployment</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/components">Component-based Cumulus Deployment</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/thin_egress_app">Using the Thin Egress App for Cumulus distribution</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/cumulus_distribution">Using the Cumulus Distribution API</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/api-gateway-logging">API Gateway Logging</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/share-s3-access-logs">Share S3 Access Logs</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/cloudwatch-logs-delivery">Configure Cloudwatch Logs Delivery</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/deployment/upgrade-readme">Upgrading Cumulus</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Configuration<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/configuration/monitoring-readme">Monitoring Best Practices</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/configuration/server_access_logging">S3 Server Access Logging</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/configuration/cloudwatch-retention">Cloudwatch Retention</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/configuration/lifecycle-policies">Setting S3 Lifecycle Policies</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/configuration/collection-storage-best-practices">Collection Cost Tracking and Storage Best Practices</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/configuration/task-configuration">Configuration of Tasks</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Development<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/developing-a-cumulus-workflow">Creating a Cumulus Workflow</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/developing-workflow-tasks">Developing Workflow Tasks</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/lambda">Develop Lambda Functions</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/docker">Dockerizing Data Processing</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflows/workflow-configuration-how-to">Workflow Configuration How To&#x27;s</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Workflow Tasks<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/tasks">Cumulus Tasks</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflow_tasks/discover_granules">Discover Granules</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflow_tasks/files_to_granules">Files To Granules</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflow_tasks/lzards_backup">LZARDS Backup</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflow_tasks/move_granules">Move Granules</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflow_tasks/parse_pdr">Parse PDR</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/workflow_tasks/queue_granules">Queue Granules</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Features<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/backup_and_restore">Cumulus Backup and Restore</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/dead_letter_queues">Dead Letter Queues</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/ems_reporting">EMS Reporting</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/execution_payload_retention">Execution Payload Retention</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/reports">Reconciliation Reports</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/lambda_versioning">Lambda Versioning</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/ancillary_metadata">Ancillary Metadata Export</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/distribution-metrics">Cumulus Distribution Metrics</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/features/logging-esdis-metrics">Writing logs for ESDIS Metrics</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Troubleshooting<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/troubleshooting/troubleshooting-readme">How to Troubleshoot and Fix Issues</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/troubleshooting/troubleshooting-deployment">Troubleshooting Deployment</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/troubleshooting/reindex-elasticsearch">Reindexing Elasticsearch Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Cumulus Development<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/adding-a-task">Contributing a Task</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/docs-how-to">Cumulus Documentation: How To&#x27;s</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Integrator Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/integrator-guide/about-int-guide">About Integrator Guide</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/integrator-guide/int-common-use-cases">Integrator Common Use Cases</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/integrator-guide/workflow-add-new-lambda">Workflow - Add New Lambda</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/integrator-guide/workflow-ts-failed-step">Workflow - Troubleshoot Failed Step(s)</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Upgrade Notes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/upgrade-notes/migrate_tea_standalone">Migrate TEA deployment to standalone module</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/upgrade-notes/upgrade_tf_version_0.13.6">Upgrade to TF version 0.13.6</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/cumulus/docs/v13.4.0/upgrade-notes/upgrade-rds">Upgrade to RDS release</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/upgrade-notes/cumulus_distribution_migration">Migrate from TEA deployment to Cumulus Distribution</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/upgrade-notes/update-task-file-schemas">Updates to task granule file schemas</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/upgrade-notes/update-cma-2.0.2">Upgrade to CMA 2.0.2</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">External Contributions<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v13.4.0/external-contributions/external-contributions">External Contributions</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Upgrade to RDS release</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="background"></a><a href="#background" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Background</h2>
<p>This release of Cumulus (9.0.0) integrates with RDS and creates a new PostgreSQL database for archiving Cumulus data (e.g. granules, files, executions).</p>
<p>While eventually Cumulus will only support using a PostgreSQL-compatible database as its data archive, for now the system will perform <strong>parallel writes</strong> to both DynamoDB and PostgreSQL so that all new data is archived in both datastores.</p>
<p>However, in order to copy all of your previously written data from DynamoDB to PostgreSQL, you will need to run data migration scripts that we have provided and which this document will explain how to use.</p>
<h2><a class="anchor" aria-hidden="true" id="upgrade-steps"></a><a href="#upgrade-steps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrade steps</h2>
<p>Follow the steps outlined below in precisely this order to upgrade your deployment and run the data migrations.</p>
<h3><a class="anchor" aria-hidden="true" id="1-deploy-a-new-rds-cluster"></a><a href="#1-deploy-a-new-rds-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Deploy a new RDS cluster</h3>
<p>Cumulus deployments require an Aurora <a href="https://www.postgresql.org/">PostgreSQL 10.2</a> compatible database to be provided in addition to the existing DynamoDB/ElasticSearch backend with the eventual goal of utilizing the PostgreSQL database as the primary data store for Cumulus.</p>
<blockquote>
<p><strong>NOTE</strong>: Users are <em>strongly</em> encouraged to plan for and implement a database solution that scales to their use requirements, meets their security posture and maintenance needs and/or allows for multi-tenant cluster usage.</p>
</blockquote>
<p>Refer to the docs on <a href="/cumulus/docs/v13.4.0/deployment/postgres_database_deployment">how to deploy a new RDS cluster</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="2-deploy-your-data-persistence-module"></a><a href="#2-deploy-your-data-persistence-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Deploy your data-persistence module</h3>
<p>The following new variables have been added to the data-persistence module:</p>
<ul>
<li><code>vpc_id</code></li>
<li><code>permissions_boundary_arn</code></li>
<li><code>rds_user_access_secret_arn</code></li>
<li><code>rds_security_group_id</code></li>
</ul>
<p>You will need to update your data-persistence module to include these new variables related to RDS. See the configuration in our template-deploy repo for reference: <a href="https://github.com/nasa/cumulus-template-deploy/tree/master/data-persistence-tf">https://github.com/nasa/cumulus-template-deploy/tree/master/data-persistence-tf</a></p>
<p>Then you can re-deploy your data-persistence module as usual:</p>
<pre><code class="hljs css language-bash">terraform apply
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="3-deploy-and-run-data-migration1"></a><a href="#3-deploy-and-run-data-migration1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Deploy and run data-migration1</h3>
<p>You will need to create a <code>data-migration1-tf</code> directory. See the configuration in our template-deploy repo for reference: <a href="https://github.com/nasa/cumulus-template-deploy/tree/master/data-migration1-tf">https://github.com/nasa/cumulus-template-deploy/tree/master/data-migration1-tf</a></p>
<p>Navigate to the directory <code>data-migration1-tf</code> and copy the following <code>.example</code> files:</p>
<pre><code class="hljs css language-shell">cp terraform.tf.example terraform.tf
cp terraform.tfvars.example terraform.tfvars
</code></pre>
<p>In <code>terraform.tf</code>, configure your remote state settings by replacing the appropriate value for <code>PREFIX</code>.</p>
<p>In <code>terraform.tfvars</code> replace the appropriate values for the following variables:</p>
<ul>
<li><code>prefix</code></li>
<li><code>data_persistence_remote_state_config</code></li>
<li><code>permissions_boundary_arn</code></li>
<li><code>lambda_subnet_ids</code></li>
<li><code>vpc_id</code></li>
<li><code>provider_kms_key_id</code></li>
</ul>
<p>These values should match the values used for your Cumulus Core deployment.</p>
<p>After replacing those values, run <code>terraform init</code>.
The output should resemble the following:</p>
<pre><code class="hljs css language-shell">Initializing modules...

Initializing the backend...

Initializing provider plugins...
- Using previously-installed hashicorp/aws v3.34.0
- terraform.io/builtin/terraform is built in to Terraform

Terraform has been successfully initialized!
</code></pre>
<p>Run  <code>terraform apply</code> to deploy <code>data-migration1</code> and type <code>yes</code> when prompted to create those resources.
On success, you will see output like:</p>
<pre><code class="hljs css language-shell">Apply complete! Resources: 2 added, 0 changed, 0 destroyed.
</code></pre>
<p>Once the deployment is complete, you can use the AWS Console or CLI to invoke the Lambda and start the data migration:</p>
<pre><code class="hljs css language-bash">aws lambda invoke --<span class="hljs-keyword">function</span>-name <span class="hljs-variable">$PREFIX</span>-data-migration1 <span class="hljs-variable">$OUTFILE</span>
</code></pre>
<p>where</p>
<ul>
<li><code>PREFIX</code> is the <code>prefix</code> value used to deploy data-migration1-tf</li>
<li><code>OUTFILE</code> (<strong>optional</strong>) is the filepath where the Lambda output (data-migration1 summary) will be saved.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="4-deploy-cumulus-module"></a><a href="#4-deploy-cumulus-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. Deploy Cumulus module</h3>
<p>The following variables were added to the Cumulus module</p>
<ul>
<li><code>rds_security_group</code></li>
<li><code>rds_user_access_secret_arn</code></li>
</ul>
<p>For reference on how to set these values, see our template-deploy repo: <a href="https://github.com/nasa/cumulus-template-deploy/tree/master/cumulus-tf">https://github.com/nasa/cumulus-template-deploy/tree/master/cumulus-tf</a></p>
<p>Instructions on deploying the Cumulus module can be found <a href="/cumulus/docs/v13.4.0/deployment/deployment-readme">here</a>.</p>
<p>The <code>cumulus</code> module will create resources including the following relevant resources for the data migration:</p>
<ul>
<li><code>${PREFIX}-data-migration2</code> Lambda</li>
<li><code>${PREFIX}-postgres-migration-async-operation</code> Lambda</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="5-run-the-second-data-migration"></a><a href="#5-run-the-second-data-migration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Run the second data migration</h3>
<blockquote>
<p><strong>Note</strong>: Please read this entire section thoroughly before proceeding to run the second data migration. In particular, pay close attention to the notes about parallelism options in order to achieve desired data migration performance while avoiding database outages and data loss.</p>
</blockquote>
<p>Now that Cumulus module is deployed, we can use some newly created resources to migrate granule, execution, and PDR data from DynamoDB to our PostgreSQL database.</p>
<p>This second data migration process can be run by invoking the provided <code>${PREFIX}-postgres-migration-async-operation</code> Lambda included in the Cumulus module deployment.
This Lambda starts an asynchronous operation which runs as an ECS task to run the migration.</p>
<p>To invoke the Lambda and start the data migration, you can use the AWS Console or CLI:</p>
<pre><code class="hljs css language-bash">aws lambda invoke --<span class="hljs-keyword">function</span>-name <span class="hljs-variable">$PREFIX</span>-postgres-migration-async-operation \
  --payload <span class="hljs-variable">$PAYLOAD</span> <span class="hljs-variable">$OUTFILE</span>
</code></pre>
<p>where</p>
<ul>
<li><p><code>PAYLOAD</code> (<strong>optional</strong>) is a base64 encoded JSON object. No payload is required to run this data migration, but configuring some of the payload options for parallelism can significantly decrease the duration of the data migration. For reference, in our testing using a value of <code>50</code> for <code>executionMigrationParams.parallelScanSegments</code> and <code>executionMigrationParams.writeConcurrency</code> migrated ~900,000 execution records in 45 minutes and did not spike Aurora PostgreSQL database capacity above 2 ACUs. See the <a href="#postgres-migration-async-operation-payload-parameters">full description of payload parameters below</a> for how to configure the parallelism of the migration. An example payload configuration might look like:</p>
<pre><code class="hljs css language-bash">--payload $(<span class="hljs-built_in">echo</span> <span class="hljs-string">'{"executionMigrationParams": { "parallelScanSegments": 50,
"writeConcurrency": 50 }}'</span> | base64)
</code></pre></li>
<li><p><code>PREFIX</code> is your Cumulus deployment prefix.</p></li>
<li><p><code>OUTFILE</code> (<strong>optional</strong>) is the filepath where the Lambda output (data-migration2 summary) will be saved.</p></li>
</ul>
<p>The Lambda will trigger an Async Operation and return an <code>id</code> such as:</p>
<pre><code class="hljs css language-json">{<span class="hljs-attr">"id"</span>:<span class="hljs-string">"7ccaed31-756b-40bb-855d-e5e6d00dc4b3"</span>,<span class="hljs-attr">"status"</span>:<span class="hljs-string">"RUNNING"</span>,
<span class="hljs-attr">"taskArn"</span>:<span class="hljs-string">"arn:aws:ecs:us-east-1:AWSID:task/$PREFIX-CumulusECSCluster/123456789"</span>,
<span class="hljs-attr">"description"</span>:<span class="hljs-string">"Data Migration 2 Lambda ECS Run"</span>,<span class="hljs-attr">"operationType"</span>:<span class="hljs-string">"Data Migration"</span>}
</code></pre>
<p>which you can then query the Async Operations <a href="https://nasa.github.io/cumulus-api/#retrieve-async-operation">API Endpoint</a> for the output or status of your request. If you want to directly observe the progress of the migration as it runs, you can view the CloudWatch logs for your async operations (e.g. <code>PREFIX-AsyncOperationEcsLogs</code>).</p>
<p>Also, each run of these data migration will write a timestamped log of any errors to the following keys in the configured <code>system_bucket</code> for your deployment:</p>
<ul>
<li><code>&lt;prefix&gt;-data-migration2-execution-errors-${timestamp}.json</code></li>
<li><code>&lt;prefix&gt;-data-migration2-granulesAndFiles-errors-${timestamp}.json</code></li>
</ul>
<blockquote>
<p><strong>Please note:</strong> Since this data migration is copying <strong>all of your execution, granule, and PDR data from DynamoDB to PostgreSQL</strong>, it can take multiple hours (or even days) to run, depending on how much data you have and how much parallelism you configure the migration to use. In general, the more parallelism you configure the migration to use, the faster it will go, <strong>but the higher load it will put on your PostgreSQL database. Excessive database load can cause database outages and result in data loss.</strong> Thus, the parallelism settings for the migration are intentionally set by default to conservative values but are configurable.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="postgres-migration-async-operation-payload-parameters"></a><a href="#postgres-migration-async-operation-payload-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>postgres-migration-async-operation payload parameters</h4>
<table>
<thead>
<tr><th>Variable</th><th>Type</th><th>Description</th><th>Default</th></tr>
</thead>
<tbody>
<tr><td>migrationsList</td><td>string[]</td><td>An array containing the names of the data types that you want to migrate. For the first run of this migration, you need to run at least the <code>executions</code> migration, since the other data types may need to refer to execution records existing in PostgreSQL.</td><td>['executions', 'granules', 'pdrs']</td></tr>
<tr><td>executionMigrationParams</td><td>Object</td><td>Options for the executions data migration</td><td><code>{}</code></td></tr>
<tr><td>executionMigrationParams.parallelScanSegments</td><td>number</td><td>The number of <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan">parallel scan</a> segments to use for executions data migration. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>20</td></tr>
<tr><td>executionMigrationParams.parallelScanLimit</td><td>number</td><td>The maximum number of records to return per each <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan">parallel scan</a> of a segment. This option was mostly provided for testing and it is not recommended to set a value.</td><td>none</td></tr>
<tr><td>executionMigrationParams.writeConcurrency</td><td>number</td><td>The maximum number of execution records to write concurrently to PostgreSQL. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>10</td></tr>
<tr><td>executionMigrationParams.loggingInterval</td><td>number</td><td>How many records to migrate before printing a log message on the status of the migration.</td><td>100</td></tr>
<tr><td>granuleMigrationParams</td><td>Object</td><td>Options for the granules data migration</td><td><code>{}</code></td></tr>
<tr><td>granuleMigrationParams.collectionId</td><td>string</td><td>A collection ID (e.g. <code>shortname___version</code>) from granule DynamoDB records. If a <code>collectionId</code> is provided, then only granules for that collection will be migrated</td><td>none</td></tr>
<tr><td>granuleMigrationParams.granuleId</td><td>string</td><td>A specific granule ID from a DynamoDB record to select for migration. If a <code>granuleId</code> and <code>collectionId</code> are provided, the <code>collectionId</code> will be ignored.</td><td>none</td></tr>
<tr><td>granuleMigrationParams.parallelScanSegments</td><td>number</td><td>The number of <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan">parallel scan</a> segments to use for granules data migration. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>20</td></tr>
<tr><td>granuleMigrationParams.parallelScanLimit</td><td>number</td><td>The maximum number of records to return per each <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan">parallel scan</a> of a segment. This option was mostly provided for testing and it is not recommended to set a value.</td><td>none</td></tr>
<tr><td>granuleMigrationParams.writeConcurrency</td><td>number</td><td>The maximum number of granule records to write concurrently to PostgreSQL. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>10</td></tr>
<tr><td>granuleMigrationParams.loggingInterval</td><td>number</td><td>How many records to migrate before printing a log message on the status of the migration.</td><td>100</td></tr>
<tr><td>granuleMigrationParams.migrateAndOverwrite</td><td>string</td><td>Set to 'true' to set migration to overwrite <em>existing</em> granule and file records in the PostgreSQL database (subject to PostgreSQL overwrite constraints).  Cannot be used with <code>migrateOnlyFiles</code></td><td>false</td></tr>
<tr><td>granuleMigrationParams.migrateOnlyFiles</td><td>string</td><td>Set to 'true' to migrate only file records for DynamoDB granule records that also exist in the PostgreSQL database (granule records that have not been migrated will report as failed for granule <em>and</em> files).  Cannot be used with <code>migrateAndOverwrite</code>.</td><td>false</td></tr>
<tr><td>pdrMigrationParams</td><td>Object</td><td>Options for the PDRs data migration</td><td><code>{}</code></td></tr>
<tr><td>pdrMigrationParams.parallelScanSegments</td><td>number</td><td>The number of <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan">parallel scan</a> segments to use for PDRs data migration. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>20</td></tr>
<tr><td>pdrMigrationParams.parallelScanLimit</td><td>number</td><td>The maximum number of records to return per each <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan">parallel scan</a> of a segment. This option was mostly provided for testing and it is not recommended to set a value.</td><td>none</td></tr>
<tr><td>pdrMigrationParams.writeConcurrency</td><td>number</td><td>The maximum number of PDR records to write concurrently to PostgreSQL. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>10</td></tr>
<tr><td>pdrMigrationParams.loggingInterval</td><td>number</td><td>How many records to migrate before printing a log message on the status of the migration.</td><td>100</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="6-run-validation-tool"></a><a href="#6-run-validation-tool" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6. Run validation tool</h3>
<p>We have provided a validation tool which provides a report regarding your data migration. For more information about this tool, refer to the <a href="https://github.com/nasa/cumulus/blob/master/lambdas/postgres-migration-count-tool/README.md">Postgres Migration Count Tool README</a>.</p>
<p>This tool can be run in the following two ways:</p>
<ul>
<li>Through direct Lambda invocation</li>
<li>Through API invocation</li>
</ul>
<blockquote>
<p><strong>Note:</strong> If the migration validation tool reveals discrepancies between your DynamoDB and PostgreSQL data, you can <a href="#5-run-the-second-data-migration">re-run the second data migration as described in step 5</a> to correct your data or to add missing data.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="direct-lambda-invocation"></a><a href="#direct-lambda-invocation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Direct Lambda invocation</h4>
<p>Invoking the Lambda on the command line looks like:</p>
<pre><code class="hljs css language-bash">aws lambda invoke --<span class="hljs-keyword">function</span>-name <span class="hljs-variable">$PREFIX</span>-postgres-migration-count-tool \
  --payload <span class="hljs-variable">$PAYLOAD</span> <span class="hljs-variable">$OUTFILE</span>
</code></pre>
<p>where</p>
<ul>
<li><code>PAYLOAD</code> is a base64 encoded JSON object. For example,</li>
</ul>
<pre><code class="hljs css language-bash">--payload $(<span class="hljs-built_in">echo</span> <span class="hljs-string">'{"reportBucket": "someBucket", "reportPath": "somePath",
"cutoffSeconds": 60, "dbConcurrency": 20, "dbMaxPool": 20}'</span> | base64)
</code></pre>
<ul>
<li><code>OUTFILE</code> is the filepath to store the output from the Lambda.</li>
<li><code>PREFIX</code> is your Cumulus deployment prefix.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: This will invoke the Lambda synchronously. Depending on your data holdings, the execution time of this Lambda may exceed the 15 minute AWS Lambda limit. <strong>If this occurs, you will need to invoke the tool via the API as an asynchronous operation as described below.</strong></p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="api-invocation"></a><a href="#api-invocation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API invocation</h4>
<p>Invoking the API on the command line looks like the following:</p>
<pre><code class="hljs css language-bash">curl -X POST https://<span class="hljs-variable">$API_URL</span>/dev/migrationCounts -d <span class="hljs-string">'reportBucket=someBucket&amp;
reportPath=someReportPath&amp;cutoffSeconds=60&amp;dbConcurrency=20&amp;dbMaxPool=20'</span> --header
<span class="hljs-string">'Authorization: Bearer $TOKEN'</span>
</code></pre>
<p>In this instance, the API will trigger an Async Operation and return an <code>id</code> such as:</p>
<pre><code class="hljs css language-json">{<span class="hljs-attr">"id"</span>:<span class="hljs-string">"7ccaed31-756b-40bb-855d-e5e6d00dc4b3"</span>,<span class="hljs-attr">"status"</span>:<span class="hljs-string">"RUNNING"</span>,
<span class="hljs-attr">"taskArn"</span>:<span class="hljs-string">"arn:aws:ecs:us-east-1:AWSID:task/$PREFIX-CumulusECSCluster/123456789"</span>,
<span class="hljs-attr">"description"</span>:<span class="hljs-string">"Migration Count Tool ECS Run"</span>,<span class="hljs-attr">"operationType"</span>:<span class="hljs-string">"Migration Count Report"</span>}
</code></pre>
<p>which you can then query the Async Operations <a href="https://nasa.github.io/cumulus-api/#retrieve-async-operation">API Endpoint</a> for the output or status of your request.</p>
<h4><a class="anchor" aria-hidden="true" id="payload-parameters"></a><a href="#payload-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Payload parameters</h4>
<p>The following optional parameters are used by this tool:</p>
<table>
<thead>
<tr><th>Variable</th><th>Type</th><th>Description</th><th>Default</th></tr>
</thead>
<tbody>
<tr><td>reportBucket</td><td>string</td><td>Sets the bucket used for reporting. If this argument is used, a <code>reportPath</code> must be set to generate a report.</td><td></td></tr>
<tr><td>reportPath</td><td>string</td><td>Sets the path location for the tool to write a copy of the Lambda payload to S3</td><td></td></tr>
<tr><td>cutoffSeconds</td><td>number</td><td>Number of seconds prior to this execution to 'cutoff' reconciliation queries. This allows in-progress/other in-flight operations time to complete and propagate to Elasticsearch/Dynamo/postgres.</td><td>3600</td></tr>
<tr><td>dbConcurrency</td><td>number</td><td>Sets max number of parallel collections reports the script will run at a time.</td><td>20</td></tr>
<tr><td>dbMaxPool</td><td>number</td><td>Sets the maximum number of connections the database pool has available. Modifying this may result in unexpected failures.</td><td>20</td></tr>
</tbody>
</table>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/cumulus/docs/v13.4.0/upgrade-notes/upgrade_tf_version_0.13.6"><span class="arrow-prev">← </span><span>Upgrade to TF version 0.13.6</span></a><a class="docs-next button" href="/cumulus/docs/v13.4.0/upgrade-notes/cumulus_distribution_migration"><span>Migrate from TEA deployment to Cumulus Distribution</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#background">Background</a></li><li><a href="#upgrade-steps">Upgrade steps</a><ul class="toc-headings"><li><a href="#1-deploy-a-new-rds-cluster">1. Deploy a new RDS cluster</a></li><li><a href="#2-deploy-your-data-persistence-module">2. Deploy your data-persistence module</a></li><li><a href="#3-deploy-and-run-data-migration1">3. Deploy and run data-migration1</a></li><li><a href="#4-deploy-cumulus-module">4. Deploy Cumulus module</a></li><li><a href="#5-run-the-second-data-migration">5. Run the second data migration</a></li><li><a href="#6-run-validation-tool">6. Run validation tool</a></li></ul></li></ul></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '1a3df8fed03e0ad718e663c44a94fe41',
                indexName: 'nasa_cumulus',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:v13.4.0"]}
              });
            </script></body></html>