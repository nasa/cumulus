<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v11.1.0 plugin-docs plugin-id-default docs-doc-id-upgrade-notes/upgrade-rds" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Upgrade to RDS release | Cumulus Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nasa.github.io/cumulus/docs/v11.1.0/upgrade-notes/upgrade-rds"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v11.1.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v11.1.0"><meta data-rh="true" name="docsearch:version" content="v11.1.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v11.1.0"><meta data-rh="true" property="og:title" content="Upgrade to RDS release | Cumulus Documentation"><meta data-rh="true" name="description" content="Background"><meta data-rh="true" property="og:description" content="Background"><link data-rh="true" rel="icon" href="/cumulus/img/cumulus.ico"><link data-rh="true" rel="canonical" href="https://nasa.github.io/cumulus/docs/v11.1.0/upgrade-notes/upgrade-rds"><link data-rh="true" rel="alternate" href="https://nasa.github.io/cumulus/docs/v11.1.0/upgrade-notes/upgrade-rds" hreflang="en"><link data-rh="true" rel="alternate" href="https://nasa.github.io/cumulus/docs/v11.1.0/upgrade-notes/upgrade-rds" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KBWSJQ0LBW-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Cumulus Documentation" href="/cumulus/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/cumulus/assets/css/styles.d37fa5d4.css">
<link rel="preload" href="/cumulus/assets/js/runtime~main.6d34a879.js" as="script">
<link rel="preload" href="/cumulus/assets/js/main.1257b213.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cumulus/"><div class="navbar__logo"><img src="/cumulus/img/ic_cumulus_logo_white.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA" height="32" width="32"><img src="/cumulus/img/ic_cumulus_logo_white.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU" height="32" width="32"></div><b class="navbar__title text--truncate">Cumulus Documentation</b></a><a href="https://nasa.github.io/cumulus-api" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://nasa.github.io/cumulus-distribution-api" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Distribution API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus/docs/v11.1.0/">Developer Docs</a><a class="navbar__item navbar__link" href="/cumulus/docs/v11.1.0/data-cookbooks/about-cookbooks">Data Cookbooks</a><a class="navbar__item navbar__link" href="/cumulus/docs/v11.1.0/operator-docs/about-operator-docs">Operator Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/cumulus/docs/v11.1.0/">v11.1.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cumulus/docs/next/upgrade-notes/upgrade-rds">Next</a></li><li><a class="dropdown__link" href="/cumulus/docs/upgrade-notes/upgrade-rds">v19.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.4.0/upgrade-notes/upgrade-rds">v18.4.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.3.4/upgrade-notes/upgrade-rds">v18.3.4</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.2.0/upgrade-notes/upgrade-rds">v18.2.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.1.0/upgrade-notes/upgrade-rds">v18.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v18.0.0/upgrade-notes/upgrade-rds">v18.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v17.0.0/upgrade-notes/upgrade-rds">v17.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v16.1.3/upgrade-notes/upgrade-rds">v16.1.3</a></li><li><a class="dropdown__link" href="/cumulus/docs/v16.0.0/upgrade-notes/upgrade-rds">v16.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v15.0.2/upgrade-notes/upgrade-rds">v15.0.2</a></li><li><a class="dropdown__link" href="/cumulus/docs/v14.1.0/upgrade-notes/upgrade-rds">v14.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v13.4.0/upgrade-notes/upgrade-rds">v13.4.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v13.0.0/upgrade-notes/upgrade-rds">v13.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v12.0.0/upgrade-notes/upgrade-rds">v12.0.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cumulus/docs/v11.1.0/upgrade-notes/upgrade-rds">v11.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v11.0.0/upgrade-notes/upgrade-rds">v11.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v10.1.0/upgrade-notes/upgrade-rds">v10.1.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v10.0.0/upgrade-notes/upgrade-rds">v10.0.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v9.9.0/upgrade-notes/upgrade-rds">v9.9.0</a></li><li><a class="dropdown__link" href="/cumulus/docs/v9.0.0/upgrade-notes/upgrade-rds">v9.0.0</a></li><li><hr class="dropdown-separator"></li><li><a class="dropdown__link" href="/cumulus/versions">All versions</a></li></ul></div><a href="https://github.com/nasa/cumulus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="Cumulus Core GitHub Repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/architecture">About Cumulus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/workflows/">Overviews</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/deployment/">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/configuration/data-management-types">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/workflows/developing-a-cumulus-workflow">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/tasks">Workflow Tasks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/features/backup_and_restore">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/troubleshooting/">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/adding-a-task">Cumulus Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/integrator-guide/about-int-guide">Integrator Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/cumulus/docs/v11.1.0/upgrade-notes/migrate_tea_standalone">Upgrade Notes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v11.1.0/upgrade-notes/migrate_tea_standalone">Migrate TEA deployment to standalone module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v11.1.0/upgrade-notes/upgrade_tf_version_0.13.6">Upgrade to TF version 0.13.6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cumulus/docs/v11.1.0/upgrade-notes/upgrade-rds">Upgrade to RDS release</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v11.1.0/upgrade-notes/cumulus_distribution_migration">Migrate from TEA deployment to Cumulus Distribution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v11.1.0/upgrade-notes/update-task-file-schemas">Updates to task granule file schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus/docs/v11.1.0/upgrade-notes/update-cma-2.0.2">Upgrade to CMA 2.0.2</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus/docs/v11.1.0/external-contributions/">External Contributions</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cumulus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Upgrade Notes</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Upgrade to RDS release</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v11.1.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrade to RDS release</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2><p>This release of Cumulus (9.0.0) integrates with RDS and creates a new PostgreSQL database for archiving Cumulus data (e.g. granules, files, executions).</p><p>While eventually Cumulus will only support using a PostgreSQL-compatible database as its data archive, for now the system will perform <strong>parallel writes</strong> to both DynamoDB and PostgreSQL so that all new data is archived in both datastores.</p><p>However, in order to copy all of your previously written data from DynamoDB to PostgreSQL, you will need to run data migration scripts that we have provided and which this document will explain how to use.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-steps">Upgrade steps<a href="#upgrade-steps" class="hash-link" aria-label="Direct link to Upgrade steps" title="Direct link to Upgrade steps">​</a></h2><p>Follow the steps outlined below in precisely this order to upgrade your deployment and run the data migrations.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-deploy-a-new-rds-cluster">1. Deploy a new RDS cluster<a href="#1-deploy-a-new-rds-cluster" class="hash-link" aria-label="Direct link to 1. Deploy a new RDS cluster" title="Direct link to 1. Deploy a new RDS cluster">​</a></h3><p>Cumulus deployments require an Aurora <a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">PostgreSQL 10.2</a> compatible database to be provided in addition to the existing DynamoDB/ElasticSearch backend with the eventual goal of utilizing the PostgreSQL database as the primary data store for Cumulus.</p><blockquote><p><strong>NOTE</strong>: Users are <em>strongly</em> encouraged to plan for and implement a database solution that scales to their use requirements, meets their security posture and maintenance needs and/or allows for multi-tenant cluster usage.</p></blockquote><p>Refer to the docs on <a href="/cumulus/docs/v11.1.0/deployment/postgres_database_deployment">how to deploy a new RDS cluster</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-deploy-your-data-persistence-module">2. Deploy your data-persistence module<a href="#2-deploy-your-data-persistence-module" class="hash-link" aria-label="Direct link to 2. Deploy your data-persistence module" title="Direct link to 2. Deploy your data-persistence module">​</a></h3><p>The following new variables have been added to the data-persistence module:</p><ul><li><code>vpc_id</code></li><li><code>permissions_boundary_arn</code></li><li><code>rds_user_access_secret_arn</code></li><li><code>rds_security_group_id</code></li></ul><p>You will need to update your data-persistence module to include these new variables related to RDS. See the configuration in our template-deploy repo for reference: <a href="https://github.com/nasa/cumulus-template-deploy/tree/master/data-persistence-tf" target="_blank" rel="noopener noreferrer">https://github.com/nasa/cumulus-template-deploy/tree/master/data-persistence-tf</a></p><p>Then you can re-deploy your data-persistence module as usual:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">terraform apply</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-deploy-and-run-data-migration1">3. Deploy and run data-migration1<a href="#3-deploy-and-run-data-migration1" class="hash-link" aria-label="Direct link to 3. Deploy and run data-migration1" title="Direct link to 3. Deploy and run data-migration1">​</a></h3><p>You will need to create a <code>data-migration1-tf</code> directory. See the configuration in our template-deploy repo for reference: <a href="https://github.com/nasa/cumulus-template-deploy/tree/master/data-migration1-tf" target="_blank" rel="noopener noreferrer">https://github.com/nasa/cumulus-template-deploy/tree/master/data-migration1-tf</a></p><p>Navigate to the directory <code>data-migration1-tf</code> and copy the following <code>.example</code> files:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> terraform.tf.example terraform.tf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> terraform.tfvars.example terraform.tfvars</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In <code>terraform.tf</code>, configure your remote state settings by replacing the appropriate value for <code>PREFIX</code>.</p><p>In <code>terraform.tfvars</code> replace the appropriate values for the following variables:</p><ul><li><code>prefix</code></li><li><code>data_persistence_remote_state_config</code></li><li><code>permissions_boundary_arn</code></li><li><code>lambda_subnet_ids</code></li><li><code>vpc_id</code></li><li><code>provider_kms_key_id</code></li></ul><p>These values should match the values used for your Cumulus Core deployment.</p><p>After replacing those values, run <code>terraform init</code>.
The output should resemble the following:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Initializing modules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Initializing the backend</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Initializing provider plugins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- Using previously-installed hashicorp/aws v3.34.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- terraform.io/builtin/terraform is built </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> to Terraform</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Terraform has been successfully initialized</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run  <code>terraform apply</code> to deploy <code>data-migration1</code> and type <code>yes</code> when prompted to create those resources.
On success, you will see output like:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Apply complete</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> Resources: </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> added, </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> changed, </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> destroyed.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the deployment is complete, you can use the AWS Console or CLI to invoke the Lambda and start the data migration:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws lambda invoke --function-name </span><span class="token variable" style="color:rgb(191, 199, 213)">$PREFIX</span><span class="token plain">-data-migration1 </span><span class="token variable" style="color:rgb(191, 199, 213)">$OUTFILE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><code>PREFIX</code> is the <code>prefix</code> value used to deploy data-migration1-tf</li><li><code>OUTFILE</code> (<strong>optional</strong>) is the filepath where the Lambda output (data-migration1 summary) will be saved.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-deploy-cumulus-module">4. Deploy Cumulus module<a href="#4-deploy-cumulus-module" class="hash-link" aria-label="Direct link to 4. Deploy Cumulus module" title="Direct link to 4. Deploy Cumulus module">​</a></h3><p>The following variables were added to the Cumulus module</p><ul><li><code>rds_security_group</code></li><li><code>rds_user_access_secret_arn</code></li></ul><p>For reference on how to set these values, see our template-deploy repo: <a href="https://github.com/nasa/cumulus-template-deploy/tree/master/cumulus-tf" target="_blank" rel="noopener noreferrer">https://github.com/nasa/cumulus-template-deploy/tree/master/cumulus-tf</a></p><p>Instructions on deploying the Cumulus module can be found <a href="/cumulus/docs/v11.1.0/deployment/">here</a>.</p><p>The <code>cumulus</code> module will create resources including the following relevant resources for the data migration:</p><ul><li><code>${PREFIX}-data-migration2</code> Lambda</li><li><code>${PREFIX}-postgres-migration-async-operation</code> Lambda</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-run-the-second-data-migration">5. Run the second data migration<a href="#5-run-the-second-data-migration" class="hash-link" aria-label="Direct link to 5. Run the second data migration" title="Direct link to 5. Run the second data migration">​</a></h3><blockquote><p><strong>Note</strong>: Please read this entire section thoroughly before proceeding to run the second data migration. In particular, pay close attention to the notes about parallelism options in order to achieve desired data migration performance while avoiding database outages and data loss.</p></blockquote><p>Now that Cumulus module is deployed, we can use some newly created resources to migrate granule, execution, and PDR data from DynamoDB to our PostgreSQL database.</p><p>This second data migration process can be run by invoking the provided <code>${PREFIX}-postgres-migration-async-operation</code> Lambda included in the Cumulus module deployment.
This Lambda starts an asynchronous operation which runs as an ECS task to run the migration.</p><p>To invoke the Lambda and start the data migration, you can use the AWS Console or CLI:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws lambda invoke --function-name </span><span class="token variable" style="color:rgb(191, 199, 213)">$PREFIX</span><span class="token plain">-postgres-migration-async-operation </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --payload </span><span class="token variable" style="color:rgb(191, 199, 213)">$PAYLOAD</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$OUTFILE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><p><code>PAYLOAD</code> (<strong>optional</strong>) is a base64 encoded JSON object. No payload is required to run this data migration, but configuring some of the payload options for parallelism can significantly decrease the duration of the data migration. For reference, in our testing using a value of <code>50</code> for <code>executionMigrationParams.parallelScanSegments</code> and <code>executionMigrationParams.writeConcurrency</code> migrated ~900,000 execution records in 45 minutes and did not spike Aurora PostgreSQL database capacity above 2 ACUs. See the <a href="#postgres-migration-async-operation-payload-parameters">full description of payload parameters below</a> for how to configure the parallelism of the migration. An example payload configuration might look like:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">--payload </span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;{&quot;executionMigrationParams&quot;: { &quot;parallelScanSegments&quot;: 50,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token variable string" style="color:rgb(195, 232, 141)">&quot;writeConcurrency&quot;: 50 }}&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> base64</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>PREFIX</code> is your Cumulus deployment prefix.</p></li><li><p><code>OUTFILE</code> (<strong>optional</strong>) is the filepath where the Lambda output (data-migration2 summary) will be saved.</p></li></ul><p>The Lambda will trigger an Async Operation and return an <code>id</code> such as:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">&quot;id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;7ccaed31-756b-40bb-855d-e5e6d00dc4b3&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RUNNING&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token property">&quot;taskArn&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arn:aws:ecs:us-east-1:AWSID:task/$PREFIX-CumulusECSCluster/123456789&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token property">&quot;description&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Data Migration 2 Lambda ECS Run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;operationType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Data Migration&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which you can then query the Async Operations <a href="https://nasa.github.io/cumulus-api/#retrieve-async-operation" target="_blank" rel="noopener noreferrer">API Endpoint</a> for the output or status of your request. If you want to directly observe the progress of the migration as it runs, you can view the CloudWatch logs for your async operations (e.g. <code>PREFIX-AsyncOperationEcsLogs</code>).</p><p>Also, each run of these data migration will write a timestamped log of any errors to the following keys in the configured <code>system_bucket</code> for your deployment:</p><ul><li><code>&lt;prefix&gt;-data-migration2-execution-errors-${timestamp}.json</code></li><li><code>&lt;prefix&gt;-data-migration2-granulesAndFiles-errors-${timestamp}.json</code></li></ul><blockquote><p><strong>Please note:</strong> Since this data migration is copying <strong>all of your execution, granule, and PDR data from DynamoDB to PostgreSQL</strong>, it can take multiple hours (or even days) to run, depending on how much data you have and how much parallelism you configure the migration to use. In general, the more parallelism you configure the migration to use, the faster it will go, <strong>but the higher load it will put on your PostgreSQL database. Excessive database load can cause database outages and result in data loss.</strong> Thus, the parallelism settings for the migration are intentionally set by default to conservative values but are configurable.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="postgres-migration-async-operation-payload-parameters">postgres-migration-async-operation payload parameters<a href="#postgres-migration-async-operation-payload-parameters" class="hash-link" aria-label="Direct link to postgres-migration-async-operation payload parameters" title="Direct link to postgres-migration-async-operation payload parameters">​</a></h4><table><thead><tr><th>Variable</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td>migrationsList</td><td>string[]</td><td>An array containing the names of the data types that you want to migrate. For the first run of this migration, you need to run at least the <code>executions</code> migration, since the other data types may need to refer to execution records existing in PostgreSQL.</td><td>[&#x27;executions&#x27;, &#x27;granules&#x27;, &#x27;pdrs&#x27;]</td></tr><tr><td>executionMigrationParams</td><td>Object</td><td>Options for the executions data migration</td><td><code>{}</code></td></tr><tr><td>executionMigrationParams.parallelScanSegments</td><td>number</td><td>The number of <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan" target="_blank" rel="noopener noreferrer">parallel scan</a> segments to use for executions data migration. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>20</td></tr><tr><td>executionMigrationParams.parallelScanLimit</td><td>number</td><td>The maximum number of records to return per each <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan" target="_blank" rel="noopener noreferrer">parallel scan</a> of a segment. This option was mostly provided for testing and it is not recommended to set a value.</td><td>none</td></tr><tr><td>executionMigrationParams.writeConcurrency</td><td>number</td><td>The maximum number of execution records to write concurrently to PostgreSQL. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>10</td></tr><tr><td>executionMigrationParams.loggingInterval</td><td>number</td><td>How many records to migrate before printing a log message on the status of the migration.</td><td>100</td></tr><tr><td>granuleMigrationParams</td><td>Object</td><td>Options for the granules data migration</td><td><code>{}</code></td></tr><tr><td>granuleMigrationParams.collectionId</td><td>string</td><td>A collection ID (e.g. <code>shortname___version</code>) from granule DynamoDB records. If a <code>collectionId</code> is provided, then only granules for that collection will be migrated</td><td>none</td></tr><tr><td>granuleMigrationParams.granuleId</td><td>string</td><td>A specific granule ID from a DynamoDB record to select for migration. If a <code>granuleId</code> and <code>collectionId</code> are provided, the <code>collectionId</code> will be ignored.</td><td>none</td></tr><tr><td>granuleMigrationParams.parallelScanSegments</td><td>number</td><td>The number of <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan" target="_blank" rel="noopener noreferrer">parallel scan</a> segments to use for granules data migration. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>20</td></tr><tr><td>granuleMigrationParams.parallelScanLimit</td><td>number</td><td>The maximum number of records to return per each <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan" target="_blank" rel="noopener noreferrer">parallel scan</a> of a segment. This option was mostly provided for testing and it is not recommended to set a value.</td><td>none</td></tr><tr><td>granuleMigrationParams.writeConcurrency</td><td>number</td><td>The maximum number of granule records to write concurrently to PostgreSQL. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>10</td></tr><tr><td>granuleMigrationParams.loggingInterval</td><td>number</td><td>How many records to migrate before printing a log message on the status of the migration.</td><td>100</td></tr><tr><td>granuleMigrationParams.migrateAndOverwrite</td><td>string</td><td>Set to &#x27;true&#x27; to set migration to overwrite <em>existing</em> granule and file records in the PostgreSQL database (subject to PostgreSQL overwrite constraints).  Cannot be used with <code>migrateOnlyFiles</code></td><td>false</td></tr><tr><td>granuleMigrationParams.migrateOnlyFiles</td><td>string</td><td>Set to &#x27;true&#x27; to migrate only file records for DynamoDB granule records that also exist in the PostgreSQL database (granule records that have not been migrated will report as failed for granule <em>and</em> files).  Cannot be used with <code>migrateAndOverwrite</code>.</td><td>false</td></tr><tr><td>pdrMigrationParams</td><td>Object</td><td>Options for the PDRs data migration</td><td><code>{}</code></td></tr><tr><td>pdrMigrationParams.parallelScanSegments</td><td>number</td><td>The number of <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan" target="_blank" rel="noopener noreferrer">parallel scan</a> segments to use for PDRs data migration. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>20</td></tr><tr><td>pdrMigrationParams.parallelScanLimit</td><td>number</td><td>The maximum number of records to return per each <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html#Scan.ParallelScan" target="_blank" rel="noopener noreferrer">parallel scan</a> of a segment. This option was mostly provided for testing and it is not recommended to set a value.</td><td>none</td></tr><tr><td>pdrMigrationParams.writeConcurrency</td><td>number</td><td>The maximum number of PDR records to write concurrently to PostgreSQL. The higher this number, the less time it will take to migrate all of your data, but also the more load that will be put on your PostgreSQL database.</td><td>10</td></tr><tr><td>pdrMigrationParams.loggingInterval</td><td>number</td><td>How many records to migrate before printing a log message on the status of the migration.</td><td>100</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-run-validation-tool">6. Run validation tool<a href="#6-run-validation-tool" class="hash-link" aria-label="Direct link to 6. Run validation tool" title="Direct link to 6. Run validation tool">​</a></h3><p>We have provided a validation tool which provides a report regarding your data migration. For more information about this tool, refer to the <a href="https://github.com/nasa/cumulus/blob/master/lambdas/postgres-migration-count-tool/README.md" target="_blank" rel="noopener noreferrer">Postgres Migration Count Tool README</a>.</p><p>This tool can be run in the following two ways:</p><ul><li>Through direct Lambda invocation</li><li>Through API invocation</li></ul><blockquote><p><strong>Note:</strong> If the migration validation tool reveals discrepancies between your DynamoDB and PostgreSQL data, you can <a href="#5-run-the-second-data-migration">re-run the second data migration as described in step 5</a> to correct your data or to add missing data.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="direct-lambda-invocation">Direct Lambda invocation<a href="#direct-lambda-invocation" class="hash-link" aria-label="Direct link to Direct Lambda invocation" title="Direct link to Direct Lambda invocation">​</a></h4><p>Invoking the Lambda on the command line looks like:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws lambda invoke --function-name </span><span class="token variable" style="color:rgb(191, 199, 213)">$PREFIX</span><span class="token plain">-postgres-migration-count-tool </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --payload </span><span class="token variable" style="color:rgb(191, 199, 213)">$PAYLOAD</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$OUTFILE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><code>PAYLOAD</code> is a base64 encoded JSON object. For example,</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">--payload </span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">&#x27;{&quot;reportBucket&quot;: &quot;someBucket&quot;, &quot;reportPath&quot;: &quot;somePath&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token variable string" style="color:rgb(195, 232, 141)">&quot;cutoffSeconds&quot;: 60, &quot;dbConcurrency&quot;: 20, &quot;dbMaxPool&quot;: 20}&#x27;</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> base64</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>OUTFILE</code> is the filepath to store the output from the Lambda.</li><li><code>PREFIX</code> is your Cumulus deployment prefix.</li></ul><blockquote><p><strong>NOTE</strong>: This will invoke the Lambda synchronously. Depending on your data holdings, the execution time of this Lambda may exceed the 15 minute AWS Lambda limit. <strong>If this occurs, you will need to invoke the tool via the API as an asynchronous operation as described below.</strong></p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-invocation">API invocation<a href="#api-invocation" class="hash-link" aria-label="Direct link to API invocation" title="Direct link to API invocation">​</a></h4><p>Invoking the API on the command line looks like the following:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST https://</span><span class="token variable" style="color:rgb(191, 199, 213)">$API_URL</span><span class="token plain">/dev/migrationCounts -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;reportBucket=someBucket&amp;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">reportPath=someReportPath&amp;cutoffSeconds=60&amp;dbConcurrency=20&amp;dbMaxPool=20&#x27;</span><span class="token plain"> --header</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Authorization: Bearer $TOKEN&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this instance, the API will trigger an Async Operation and return an <code>id</code> such as:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">&quot;id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;7ccaed31-756b-40bb-855d-e5e6d00dc4b3&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RUNNING&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token property">&quot;taskArn&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arn:aws:ecs:us-east-1:AWSID:task/$PREFIX-CumulusECSCluster/123456789&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token property">&quot;description&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Migration Count Tool ECS Run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">&quot;operationType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Migration Count Report&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which you can then query the Async Operations <a href="https://nasa.github.io/cumulus-api/#retrieve-async-operation" target="_blank" rel="noopener noreferrer">API Endpoint</a> for the output or status of your request.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="payload-parameters">Payload parameters<a href="#payload-parameters" class="hash-link" aria-label="Direct link to Payload parameters" title="Direct link to Payload parameters">​</a></h4><p>The following optional parameters are used by this tool:
| Variable      | Type   | Description                                                                                                                                                                                       | Default |
|---------------|--------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| reportBucket  | string | Sets the bucket used for reporting. If this argument is used, a <code>reportPath</code> must be set to generate a report.                                                                                    |         |
| reportPath    | string | Sets the path location for the tool to write a copy of the Lambda payload to S3                                                                                                                   |         |
| cutoffSeconds | number | Number of seconds prior to this execution to &#x27;cutoff&#x27; reconciliation queries. This allows in-progress/other in-flight operations time to complete and propagate to Elasticsearch/Dynamo/postgres. | 3600    |
| dbConcurrency | number | Sets max number of parallel collections reports the script will run at a time.                                                                                                                    | 20      |
| dbMaxPool     | number | Sets the maximum number of connections the database pool has available. Modifying this may result in unexpected failures.                                                                         | 20      |</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-03-10T00:04:48.000Z">Mar 10, 2023</time></b> by <b>jennyhliu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cumulus/docs/v11.1.0/upgrade-notes/upgrade_tf_version_0.13.6"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Upgrade to TF version 0.13.6</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cumulus/docs/v11.1.0/upgrade-notes/cumulus_distribution_migration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrate from TEA deployment to Cumulus Distribution</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#upgrade-steps" class="table-of-contents__link toc-highlight">Upgrade steps</a><ul><li><a href="#1-deploy-a-new-rds-cluster" class="table-of-contents__link toc-highlight">1. Deploy a new RDS cluster</a></li><li><a href="#2-deploy-your-data-persistence-module" class="table-of-contents__link toc-highlight">2. Deploy your data-persistence module</a></li><li><a href="#3-deploy-and-run-data-migration1" class="table-of-contents__link toc-highlight">3. Deploy and run data-migration1</a></li><li><a href="#4-deploy-cumulus-module" class="table-of-contents__link toc-highlight">4. Deploy Cumulus module</a></li><li><a href="#5-run-the-second-data-migration" class="table-of-contents__link toc-highlight">5. Run the second data migration</a></li><li><a href="#6-run-validation-tool" class="table-of-contents__link toc-highlight">6. Run validation tool</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/cumulus/assets/js/runtime~main.6d34a879.js"></script>
<script src="/cumulus/assets/js/main.1257b213.js"></script>
</body>
</html>