"use strict";(self.webpackChunk_cumulus_website=self.webpackChunk_cumulus_website||[]).push([[62194],{15680:(e,t,n)=>{n.d(t,{xA:()=>l,yg:()=>h});var a=n(96540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),d=u(n),m=i,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||r;return n?a.createElement(h,s(s({ref:t},l),{},{components:n})):a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=m;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[d]="string"==typeof e?e:i,s[1]=o;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},15884:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/kibana-step2-7555a56bf1d904678d6dbf43ac4312b5.png"},18535:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/kibana-step1-680737124f8bc21344d7fb298ea520e3.png"},78591:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/AWS-Cross-account-log-delivery-and-metrics-75732fddd412fd0a7725ed9c876294dd.png"},82545:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>u,toc:()=>d});var a=n(58168),i=n(98587),r=(n(96540),n(15680)),s=["components"],o={id:"distribution-metrics",title:"Cumulus Distribution Metrics",hide_title:!1},c=void 0,u={unversionedId:"features/distribution-metrics",id:"version-v9.0.0/features/distribution-metrics",title:"Cumulus Distribution Metrics",description:"It is possible to configure Cumulus and the Cumulus Dashboard to display information about the successes and failures of requests for data.  This requires the Cumulus instance to deliver Cloudwatch Logs and S3 Server Access logs to an ELK stack.",source:"@site/versioned_docs/version-v9.0.0/features/distribution-metrics.md",sourceDirName:"features",slug:"/features/distribution-metrics",permalink:"/cumulus/docs/v9.0.0/features/distribution-metrics",draft:!1,tags:[],version:"v9.0.0",lastUpdatedBy:"jennyhliu",lastUpdatedAt:1678406688,formattedLastUpdatedAt:"Mar 10, 2023",frontMatter:{id:"distribution-metrics",title:"Cumulus Distribution Metrics",hide_title:!1},sidebar:"docs",previous:{title:"Ancillary Metadata Export",permalink:"/cumulus/docs/v9.0.0/features/ancillary_metadata"},next:{title:"Writing logs for ESDIS Metrics",permalink:"/cumulus/docs/v9.0.0/features/logging-esdis-metrics"}},l={},d=[{value:"ESDIS Metrics in NGAP",id:"esdis-metrics-in-ngap",level:2},{value:"Cumulus / ESDIS Metrics distribution system",id:"cumulus--esdis-metrics-distribution-system",level:3},{value:"Kibana Index",id:"kibana-index",level:2}],p={toc:d},m="wrapper";function h(e){var t=e.components,o=(0,i.A)(e,s);return(0,r.yg)(m,(0,a.A)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"It is possible to configure Cumulus and the Cumulus Dashboard to display information about the successes and failures of requests for data.  This requires the Cumulus instance to deliver Cloudwatch Logs and S3 Server Access logs to an ELK stack."),(0,r.yg)("h2",{id:"esdis-metrics-in-ngap"},"ESDIS Metrics in NGAP"),(0,r.yg)("p",null,"Work with the ESDIS metrics team to set up permissions and access to forward ",(0,r.yg)("a",{parentName:"p",href:"../deployment/cloudwatch-logs-delivery"},"Cloudwatch Logs to a shared AWS:Logs:Destination")," as well as transferring your ",(0,r.yg)("a",{parentName:"p",href:"../deployment/share-s3-access-logs"},"S3 Server Access logs to a metrics team bucket"),"."),(0,r.yg)("p",null,"The metrics team has taken care of setting up logstash to ingest the files that get delivered to their bucket into their Elasticsearch instance."),(0,r.yg)("p",null,"Once Cumulus has been configured to deliver Cloudwatch logs to the ESDIS Metrics team, you can create a Kibana index pattern associated with your Cumulus stack.  The metrics team has worked out a convention with the Cumulus devlopers to ensure access to your stack's logs.  The important piece is that the Kibana index pattern is created with the exact name of the prefix (stackName) with which cumulus was deployed."),(0,r.yg)("h3",{id:"cumulus--esdis-metrics-distribution-system"},"Cumulus / ESDIS Metrics distribution system"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Architecture diagram showing how logs are replicated from a Cumulus instance to the ESDIS Metrics account and accessed by the Cumulus dashboard",src:n(78591).A,width:"1760",height:"1360"})),(0,r.yg)("h2",{id:"kibana-index"},"Kibana Index"),(0,r.yg)("p",null,"Before creating the Kibana index, verify that the Elasticsearch instance has been populated with at least one record",(0,r.yg)("sup",{parentName:"p",id:"fnref-1"},(0,r.yg)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),".  Do this by visiting the Kibana endpoint and selecting ",(0,r.yg)("inlineCode",{parentName:"p"},"Management"),", Elasticsearch ",(0,r.yg)("inlineCode",{parentName:"p"},"Index Management")," and type the stack's prefix into the search bar.  When you see an index with ",(0,r.yg)("inlineCode",{parentName:"p"},"<prefix>-cloudwatch-YYY.MM.dd")," you are ready to continue.  If you don't see at least one index for your stack, check to make sure you are delivering your logs to this Elasticsearch instance."),(0,r.yg)("p",null,"Step 1: create the index by selecting ",(0,r.yg)("inlineCode",{parentName:"p"},"Management"),", Kibana ",(0,r.yg)("inlineCode",{parentName:"p"},"Index Patterns"),".  Use an index pattern of ",(0,r.yg)("inlineCode",{parentName:"p"},"<prefix>-*")," and continue to the ",(0,r.yg)("inlineCode",{parentName:"p"},"Next step"),"."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Screenshot of Kibana console showing how to configure an index pattern to target logs from a Cumulus deployment",src:n(18535).A,width:"1055",height:"710"})),(0,r.yg)("p",null,"Step 2: Set the Time Filter field name to ",(0,r.yg)("inlineCode",{parentName:"p"},"@timestamp")," with the pulldown option. Very importantly ",(0,r.yg)("inlineCode",{parentName:"p"},"Show advanced options")," to create a Custom index Pattern ID that is your ",(0,r.yg)("inlineCode",{parentName:"p"},"<prefix>"),".  Then ",(0,r.yg)("inlineCode",{parentName:"p"},"Create index pattern"),". This important convention allows the dashboard to know which index to use to find the distribution metrics for a particular stack."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Screenshot of Kibana console showing how to configure settings for an index pattern to target logs from a Cumulus deployment",src:n(15884).A,width:"1055",height:"710"})),(0,r.yg)("div",{className:"footnotes"},(0,r.yg)("hr",{parentName:"div"}),(0,r.yg)("ol",{parentName:"div"},(0,r.yg)("li",{parentName:"ol",id:"fn-1"},"The Kibana console will not let you create an index if it doesn't match at least one Elasticsearch index.",(0,r.yg)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")))))}h.isMDXComponent=!0}}]);