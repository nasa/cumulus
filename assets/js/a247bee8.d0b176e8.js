"use strict";(self.webpackChunk_cumulus_website=self.webpackChunk_cumulus_website||[]).push([[76897],{15680:(e,r,n)=>{n.d(r,{xA:()=>p,yg:()=>c});var t=n(296540);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach(function(r){a(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function l(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=t.createContext({}),s=function(e){var r=t.useContext(u),n=r;return e&&(n="function"==typeof e?e(r):i(i({},r),e)),n},p=function(e){var r=s(e.components);return t.createElement(u.Provider,{value:r},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},g=t.forwardRef(function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(n),g=a,c=d["".concat(u,".").concat(g)]||d[g]||m[g]||o;return n?t.createElement(c,i(i({ref:r},p),{},{components:n})):t.createElement(c,i({ref:r},p))});function c(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=g;var l={};for(var u in r)hasOwnProperty.call(r,u)&&(l[u]=r[u]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}g.displayName="MDXCreateElement"},383222:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>p,contentTitle:()=>u,default:()=>c,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var t=n(58168),a=n(198587),o=(n(296540),n(15680)),i=["components"],l={id:"upgrade-terraform-1.12",title:"Upgrade to Terraform 1.12",hide_title:!1},u=void 0,s={unversionedId:"upgrade-notes/upgrade-terraform-1.12",id:"version-v20.3.0/upgrade-notes/upgrade-terraform-1.12",title:"Upgrade to Terraform 1.12",description:"Background",source:"@site/versioned_docs/version-v20.3.0/upgrade-notes/upgrade-terraform-1.12.md",sourceDirName:"upgrade-notes",slug:"/upgrade-notes/upgrade-terraform-1.12",permalink:"/cumulus/docs/upgrade-notes/upgrade-terraform-1.12",draft:!1,tags:[],version:"v20.3.0",lastUpdatedBy:"Naga Nages",lastUpdatedAt:1755629955,formattedLastUpdatedAt:"Aug 19, 2025",frontMatter:{id:"upgrade-terraform-1.12",title:"Upgrade to Terraform 1.12",hide_title:!1},sidebar:"docs",previous:{title:"Upgrading from Aurora Serverless V1 to V2",permalink:"/cumulus/docs/upgrade-notes/serverless-v2-upgrade"},next:{title:"External Contributions",permalink:"/cumulus/docs/category/external-contributions"}},p={},d=[{value:"Background",id:"background",level:2},{value:"Deployment Steps",id:"deployment-steps",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Upgrade your deployment using <code>terraform init</code>",id:"upgrade-your-deployment-using-terraform-init",level:3},{value:"Or",id:"or",level:3},{value:"Terraform Init Reconfigure",id:"terraform-init-reconfigure",level:4},{value:"Validation",id:"validation",level:3},{value:"Terraform Plan/Apply",id:"terraform-planapply",level:3}],m={toc:d},g="wrapper";function c(e){var r=e.components,n=(0,a.A)(e,i);return(0,o.yg)(g,(0,t.A)({},m,n,{components:r,mdxType:"MDXLayout"}),(0,o.yg)("h2",{id:"background"},"Background"),(0,o.yg)("p",null,"The release of Cumulus (VERSION) updates Terraform to require use of Terraform v1.12.2 and the AWS provider to at least 5.100 (but not 6)."),(0,o.yg)("p",null,"This upgrade requires updates to your deployment environment (updating to use Terraform 1.12.2), as well as manually tested deployment steps to upgrade your deployment.    This document provides an upgrade example assuming manual deployment via the terraform command line.    These steps should be followed for ",(0,o.yg)("em",{parentName:"p"},"each")," terraform stack deployed as part of your cumulus deployment."),(0,o.yg)("h3",{id:"deployment-steps"},"Deployment Steps"),(0,o.yg)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Follow the ",(0,o.yg)("a",{parentName:"li",href:"https://developer.hashicorp.com/terraform/language/upgrade-guides"},"Terraform guidance for what to do before upgrading"),", reviewing all the changes from 1.5.3 to 1.12 with respect to any custom/outside Cumulus terraform code, ",(0,o.yg)("strong",{parentName:"li"},"notably ensuring that you have no pending changes to your Cumulus deployments before proceeding"),"."),(0,o.yg)("li",{parentName:"ul"},"Prior to updating terraform you should deploy to the release prior to this update.    Updating from prior versions directly to this release ",(0,o.yg)("em",{parentName:"li"},"may")," work, but have not been extensively tested."),(0,o.yg)("li",{parentName:"ul"},"You should do a ",(0,o.yg)("inlineCode",{parentName:"li"},"terraform plan")," to see if you have any pending changes for your deployment (for the ",(0,o.yg)("inlineCode",{parentName:"li"},"data-persistence-tf"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"cumulus-tf")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"rds-cluster-tf")," modules), and if so, run a ",(0,o.yg)("inlineCode",{parentName:"li"},"terraform apply")," ",(0,o.yg)("strong",{parentName:"li"},"before doing the upgrade to Terraform 1.12.2")),(0,o.yg)("li",{parentName:"ul"},"Install Terraform version 1.12.2. We recommend using Terraform Version Manager ",(0,o.yg)("a",{parentName:"li",href:"https://github.com/tfutils/tfenv"},"tfenv")," to manage your installed versons of Terraform, but this is not required."),(0,o.yg)("li",{parentName:"ul"},"Ensure that you are running the correct version of Terraform by running ",(0,o.yg)("inlineCode",{parentName:"li"},"terraform --version"),". If you are using ",(0,o.yg)("inlineCode",{parentName:"li"},"tfenv"),", you can switch versions by running ",(0,o.yg)("inlineCode",{parentName:"li"},"tfenv use 1.12.2"),"."),(0,o.yg)("li",{parentName:"ul"},"This document assumes you are using terraform remote states as recommended in the Cumulus deploy documentation"),(0,o.yg)("li",{parentName:"ul"},"This document requires that you evaluate all custom code/external modules being deployed in combination with Cumulus Core that are not part of the Cumulus Core project.      Core has tested Orca v10.0.1 as part of our integration tests only.")),(0,o.yg)("h3",{id:"upgrade-your-deployment-using-terraform-init"},"Upgrade your deployment using ",(0,o.yg)("inlineCode",{parentName:"h3"},"terraform init")),(0,o.yg)("p",null,"For each stack you are deploying, you will need to either:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Run ",(0,o.yg)("inlineCode",{parentName:"li"},"terraform init")," in absence of local terraform state/configuration.  This should update the remote state and allow a ",(0,o.yg)("inlineCode",{parentName:"li"},"terraform apply")," to proceed with the new version of Terraform.    This is most likely in CI/one-off deployment environments without persistent storage.")),(0,o.yg)("h3",{id:"or"},"Or"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"If you are running in an environment with a stored local plugins/state in your ",(0,o.yg)("inlineCode",{parentName:"li"},".terraform")," directory, run ",(0,o.yg)("inlineCode",{parentName:"li"},"terraform init --reconfigure"),".   Details are as follows:")),(0,o.yg)("h4",{id:"terraform-init-reconfigure"},"Terraform Init Reconfigure"),(0,o.yg)("p",null,"Attempting to run terraform init/updates with local Terraform configuration  information from a prior deployment will result in an error message similar to:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'->terraform init\nInitializing the backend...\nInitializing modules...\n\u2577\n\u2502 Error: Backend configuration changed\n\u2502\n\u2502 A change in the backend configuration has been detected, which may require migrating existing state.\n\u2502\n\u2502 If you wish to attempt automatic migration of the state, use "terraform init -migrate-state".\n\u2502 If you wish to store the current configuration with no changes to the state, use "terraform init -reconfigure".\n\u2575\n')),(0,o.yg)("p",null,"This is due to changes made in Terraform as part of release 1.10 and 1.8:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.hashicorp.com/terraform/language/v1.8.x/upgrade-guides"},"https://developer.hashicorp.com/terraform/language/v1.8.x/upgrade-guides")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.hashicorp.com/terraform/language/v1.10.x/upgrade-guides"},"https://developer.hashicorp.com/terraform/language/v1.10.x/upgrade-guides"))),(0,o.yg)("p",null,"To 'upgrade', either remove the local configuration ",(0,o.yg)("em",{parentName:"p"},"or")," run the following:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'-> terraform init --reconfigure\n\nInitializing the backend...\n\nSuccessfully configured the backend "s3"! Terraform will automatically\nuse this backend unless the backend configuration changes.\nInitializing modules...\nInitializing provider plugins...\n- terraform.io/builtin/terraform is built in to Terraform\n- Reusing previous version of hashicorp/aws from the dependency lock file\n- Reusing previous version of hashicorp/random from the dependency lock file\n- Reusing previous version of hashicorp/null from the dependency lock file\n- Using previously-installed hashicorp/aws v5.100.0\n- Using previously-installed hashicorp/random v3.7.2\n- Using previously-installed hashicorp/null v3.1.1\n\nTerraform has been successfully initialized!\n\nYou may now begin working with Terraform. Try running "terraform plan" to see\nany changes that are required for your infrastructure. All Terraform commands\nshould now work.\n\nIf you ever set or change modules or backend configuration for Terraform,\nrerun this command to reinitialize your working directory. If you forget, other\ncommands will detect it and remind you to do so if necessary.\n')),(0,o.yg)("h3",{id:"validation"},"Validation"),(0,o.yg)("p",null,"Validation of the current statefile version can be done via the command line:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"terraform show -json | jq '.terraform_version'\n")),(0,o.yg)("p",null,"If the upgrade was successful this should result in output like:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'"1.12.2"\n')),(0,o.yg)("h3",{id:"terraform-planapply"},"Terraform Plan/Apply"),(0,o.yg)("p",null,"Once your terraform state has been updated, you can run ",(0,o.yg)("inlineCode",{parentName:"p"},"terraform plan")," and/or ",(0,o.yg)("inlineCode",{parentName:"p"},"terraform apply")," as you normally would."))}c.isMDXComponent=!0}}]);