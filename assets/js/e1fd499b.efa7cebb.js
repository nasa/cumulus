"use strict";(self.webpackChunk_cumulus_website=self.webpackChunk_cumulus_website||[]).push([[74859],{15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>m});var r=n(296540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef(function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),g=i,m=d["".concat(l,".").concat(g)]||d[g]||c[g]||a;return n?r.createElement(m,o(o({ref:t},p),{},{components:n})):r.createElement(m,o({ref:t},p))});function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:i,o[1]=s;for(var u=2;u<a;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},902750:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>u,toc:()=>d});var r=n(58168),i=n(198587),a=(n(296540),n(15680)),o=["components"],s={id:"record_write_options",title:"Options for writing records to Cumulus datastore during workflow executions",hide_title:!1},l=void 0,u={unversionedId:"features/record_write_options",id:"version-v21.1.0/features/record_write_options",title:"Options for writing records to Cumulus datastore during workflow executions",description:'Cumulus, by default, will write records involved in a workflow execution to the Cumulus datastore at several points during the execution. The records written include granules, pdrs, and executions, and these are stored in the Cumulus database when an execution\'s status changes to "running", "completed", or "failed".',source:"@site/versioned_docs/version-v21.1.0/features/record_write_options.md",sourceDirName:"features",slug:"/features/record_write_options",permalink:"/cumulus/docs/features/record_write_options",draft:!1,tags:[],version:"v21.1.0",lastUpdatedBy:"Tim Clark",lastUpdatedAt:1761159750,formattedLastUpdatedAt:"Oct 22, 2025",frontMatter:{id:"record_write_options",title:"Options for writing records to Cumulus datastore during workflow executions",hide_title:!1},sidebar:"docs",previous:{title:"Writing logs for ESDIS Metrics",permalink:"/cumulus/docs/features/logging-esdis-metrics"},next:{title:"How to replay Kinesis messages after an outage",permalink:"/cumulus/docs/features/replay-kinesis-messages"}},p={},d=[{value:"Skipping record writes",id:"skipping-record-writes",level:2}],c={toc:d},g="wrapper";function m(e){var t=e.components,n=(0,i.A)(e,o);return(0,a.yg)(g,(0,r.A)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("p",null,'Cumulus, by default, will write records involved in a workflow execution to the Cumulus datastore at several points during the execution. The records written include granules, pdrs, and executions, and these are stored in the Cumulus database when an execution\'s status changes to "running", "completed", or "failed".'),(0,a.yg)("p",null,'For example, when a workflow is successfully triggered, records will be written to the datastore when that execution starts. This will include a granule record in its initial "running" state:'),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "granuleId": "L2_HR_PIXC_A_zHGdMM",\n  "producerGranuleId": "L2_HR_PIXC_A",\n  "status": "running",\n}\n')),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"This is an API-formatted granule. Granule records in the Postgres datastore will have different formatting.")),(0,a.yg)("p",null,"As the workflow progresses, this granule will be updated with ",(0,a.yg)("inlineCode",{parentName:"p"},"status: 'completed'")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"status: 'failed'")," as appropriate."),(0,a.yg)("h2",{id:"skipping-record-writes"},"Skipping record writes"),(0,a.yg)("p",null,"If desired, workflows can be configured to write only specified record types when a specified status is reached. For example, an ",(0,a.yg)("inlineCode",{parentName:"p"},"IngestAndPublishGranule")," workflow configured with the following options in the ",(0,a.yg)("inlineCode",{parentName:"p"},"sf_event_sqs_to_db_record_types")," block will only write ",(0,a.yg)("inlineCode",{parentName:"p"},"execution")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"pdr")," records in the ",(0,a.yg)("inlineCode",{parentName:"p"},"running")," status. This configuration has the effect of skipping ",(0,a.yg)("inlineCode",{parentName:"p"},"granule")," database writes when the execution reaches the ",(0,a.yg)("inlineCode",{parentName:"p"},"running")," status. Subsequent write requests for ",(0,a.yg)("inlineCode",{parentName:"p"},"granules")," in the ",(0,a.yg)("inlineCode",{parentName:"p"},"completed")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"failed")," status will write as normal."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-js"},'{\n    sf_event_sqs_to_db_records_types = {\n        IngestAndPublishGranule = {\n            running = ["execution", "pdr"]\n        }\n    }\n}\n')),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"There is a drawback to skipping the initial ",(0,a.yg)("inlineCode",{parentName:"p"},"granule"),' record write in PDR workflows. If the "running" granule is not written, there will be no link between the incoming ',(0,a.yg)("inlineCode",{parentName:"p"},"granule")," and the incoming ",(0,a.yg)("inlineCode",{parentName:"p"},"pdr")," until that ",(0,a.yg)("inlineCode",{parentName:"p"},"granule")," is written. In this case it may be necessary to introduce an additional database write step to store the ",(0,a.yg)("inlineCode",{parentName:"p"},"granule")," ",(0,a.yg)("em",{parentName:"p"},"after")," the unique ",(0,a.yg)("inlineCode",{parentName:"p"},"granuleId")," has been generated via the ",(0,a.yg)("inlineCode",{parentName:"p"},"AddUniqueGranuleId")," task."),(0,a.yg)("p",{parentName:"admonition"},(0,a.yg)("a",{parentName:"p",href:"https://github.com/nasa/cumulus/tree/master/tasks/sf-sqs-report"},"The SfSqsReport Task")," can be used for this purpose. If inserted after the ",(0,a.yg)("inlineCode",{parentName:"p"},"AddUniqueGranuleId")," Task, and given a payload that includes both the ",(0,a.yg)("inlineCode",{parentName:"p"},"granule")," and the ",(0,a.yg)("inlineCode",{parentName:"p"},"PDR"),", it will store the ",(0,a.yg)("inlineCode",{parentName:"p"},"granule")," correctly with the appropriate linkage.")),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"See the ",(0,a.yg)("inlineCode",{parentName:"p"},"sf_event_sqs_to_db_records_types")," definition in ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/nasa/cumulus/blob/master/tf-modules/ingest/variables.tf"},"the terraform variable definitions")," for a complete list of the possible record types and states.")))}m.isMDXComponent=!0}}]);